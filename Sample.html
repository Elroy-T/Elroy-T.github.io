<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sample</title>
    <script src="JS/three.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
            crossorigin="anonymous"></script>
<!--    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>-->
    <script src = "JS/FileSaver.js"></script>
    <script src = "JS/html2canvas.js"></script>
<!--    <script type="text/javascript" src="http://html2canvas.hertzen.com/build/html2canvas.js"></script>-->
    <script src = "JS/canvas2image.js"></script>
    <style type="text/css">

        div#canvas-frame {
            margin-left: 250px;
            float:left;
            border: none;
            cursor: pointer;
            width: 1000px;
            height: 900px;
            background-color: #EEEEEE;
        }
        div#canvas-legend {
            margin-left: 10px;
            float:left;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 340px;
            height: 320px;
            background-color: #0A0B11;
        }

        #header{
            color: ghostwhite;
            font-size: 25px;
        }
        div#legend-zone {
            /*margin-left: 1250px;*/
            margin-top: 80px;
            border: 1px solid #8c96a3;
            border-radius: 10px;
            float:left;
            width: 400px;
            height: 400px;
            background-color: #EEEEEE;
        }
        div#json-zone {
            /*margin-left: 1250px;*/
            margin-top: 20px;
            float: left;
            /*border: 1px solid #4C5B5C;*/
            border-radius: 10px;
            cursor: pointer;
            width: 400px;
            height: 400px;
            background-color: #007bff;/*#1f283e;*/
        }
        code#json-code{
            color: #f7f1f1;
            font-size: 15px;
            float:left;
            padding-left: 55px;
        }



    </style>


    <!-- ------------------ 网页设计 -------------------- -->
    <link rel="icon" href="assets/img/icon.ico" type="image/x-icon"/>

    <!-- Fonts and icons -->
    <script src="assets/js/plugin/webfont/webfont.min.js"></script>
    <script>
        WebFont.load({
            google: {"families":["Lato:300,400,700,900"]},
            custom: {"families":["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"], urls: ['assets/css/fonts.min.css']},
            active: function() {
                sessionStorage.fonts = true;
            }
        });
    </script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/atlantis.min.css">

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link rel="stylesheet" href="assets/css/demo.css">


    <script>
        /* json点阵分布：256*256
        * 棋盘大小：256*4 = 1024
        * tile大小：4*4=16 or 16*4=64
        *
        * */
        var points = [];
        var lines = [];
        var legends = [];

        var renderer;
        var dataset_source = 0;//[0,1,2]
        var rebin_type = 0;
        var rebin_square_size_type = 1;//[0,1,2,3]   3 = Auto
        var rebin_square_size_type_auto = 1;//[0 s,1 m,2 l]
        var rebin_square_size = [32,64,128,64];//[0,1,2]
        var scale_type = 0;
        var mood = 0;
        var smooth_if = 0;
        var smooth_core = 1;
        var legend_if = 1;
        var axis_if = 1;

        var class_num = 4;
        var point_max = 1;//单元格内单颜色点最多的格内的点数
        var point_max_pixel = 1;//一种颜色的点最多的像素包含的这种颜色的点
        var point_max_sum = 1;//单元格内所有点相加最多的点数
        var point_max_pixel_color = [0,0,0,0];
        var board_length = 1024;//显示版面边长
        var board_length_x = 1024;//显示版面边长
        var board_length_y = 1024;//显示版面边长


        var tile_num = 16;//每行单元格个数
        var tile_num_x = 16;//每行单元格个数
        var tile_num_y = 16;//每行单元格个数

        var side_length = 64;//每个单元格边长


        var pixel_num = 256;//json文件中点的坐标取值范围
        var pixel_num_x = 256;//json文件中点的坐标取值范围
        var pixel_num_y = 256;//json文件中点的坐标取值范围

        var tile_point_size = [74,147,298,147];//单元格覆盖点的大小
        var point_size = 9;
        var point_size_alpha = 2;
        var tile_point_z = 0;//单元格覆盖点的z轴坐标
        var point_per_tile = pixel_num / tile_num;//每个单元格中每行有多少个json点坐标

        var colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
        var colors_class_0 = [1,0,0];
        var colors_class_1 = [0,1,0];
        var colors_class_2 = [0,0,1];
        var colors_class_3 = [1,1,0];




        var angles = [1/2, 1, 2,8];

        var data_vector = new Array(); //数据向量
        // for ( let i = 0; i < tile_num; i++) { //一维长度为2
        //     data_vector[i] = new Array(); //再声明二维
        //     for ( let j = 0; j < tile_num; j++) { //二维长度为3
        //         data_vector[i][j] = new Array(); //再声明二维
        //         for ( let z = 0; z < class_num; z++) { //二维长度为3
        //             data_vector[i][j][z] = 0; // 赋值，每个数组元素的值为i+j
        //         }
        //     }
        // }
        var data_buffer = new Array(); //先声明一维
        for ( let i = 0; i < pixel_num; i++) {
            data_buffer[i] = new Array(); //再声明二维
            for ( let j = 0; j < pixel_num; j++) {
                data_buffer[i][j] = new Array(); //再声明二维
                for ( let z = 0; z < class_num; z++) { //二维长度为3
                    data_buffer[i][j][z] = 0; // 赋值，每个数组元素的值为i+j
                }
            }
        }

        //高斯平滑所需要的临时矩阵
        // var smooth_if = 0;
        // var smooth_core = 1;//已在前面声明
        var data_buffer_smooth = new Array(); //先声明一维
        for ( let i = 0; i < pixel_num; i++) {
            data_buffer_smooth[i] = new Array(); //再声明二维
            for ( let j = 0; j < pixel_num; j++) {
                data_buffer_smooth[i][j] = new Array(); //再声明二维
                for ( let z = 0; z < class_num; z++) { //二维长度为3
                    data_buffer_smooth[i][j][z] = 0; // 赋值，每个数组元素的值为i+j
                }
            }
        }
//------------------classbuffer----------------
        var class_buffer0;
        var class_buffer1;
        var class_buffer2;
        var class_buffer3;

        function class_buffer(num,data_buffer,color,angle,scale) {
            this.num = num;                 //类缓冲区编号
            this.data_buffer = data_buffer; //类缓冲区中的数据缓冲区
            this.color = color;             //类缓冲区对应颜色
            this.angle = angle;             //类缓冲区阴影角
            this.scale = scale;             //比例尺

            if(class_buffer._init==undefined) {
                //alert("我只执行一次！");
                class_buffer.prototype.getNum = function() {
                    return this.num;
                };
                class_buffer.prototype.getDataBuffer = function() {
                    return this.data_buffer;
                };
                class_buffer.prototype.getColor = function() {
                    return this.color;
                };
                class_buffer.prototype.getAngle = function() {
                    return this.angle;
                };
                class_buffer.prototype.getScale = function() {
                    return this.scale;
                };
                class_buffer._init = 1;
            }
        }
//-------------------------------------------------

        /*  json 语句相关变量   */
        var json_url1 = 'data/mn_cat_1.json';// data/mn_cat_1.json
        var json_url2 = 'data/mn_cat_2.json';// data/mn_cat_1.json
        var json_url3 = 'data/mn_cat_3.json';// data/mn_cat_1.json
        var json_url4 = 'data/mn_cat_4.json';// data/mn_cat_1.json
        var json_colors_class_0 = '[1,0,0]';
        var json_colors_class_1 = '[0,1,0]';
        var json_colors_class_2 = '[0,0,1]';
        var json_colors_class_3 = '[1,1,0]';

        var json_rebin = 'None';//square
        var json_rebin_size = 'Default';
        var json_scale = 'Linear';// Log, Square Root, Cubic Root, Equi-depth
        var json_compose = 'Max'; //Max, Mean, Invmin, Blend, Weaving, Propling, Division, Separate, Time
        var json_smooth = 'False';//True
        var json_smooth_core = 0;
        var json_legend = 'False';//False
        var json_axis = 'False';//True

        var json_url1_set = ['data/mn_cat_1.json','data/mydata1.json','data/notMNIST_xylab_cat_A.json'];// data/mn_cat_1.json
        var json_url2_set = ['data/mn_cat_2.json','data/mydata2.json','data/notMNIST_xylab_cat_B.json'];// data/mn_cat_1.json
        var json_url3_set = ['data/mn_cat_3.json','data/mydata3.json','data/notMNIST_xylab_cat_C.json'];// data/mn_cat_1.json
        var json_url4_set = ['data/mn_cat_4.json','data/mydata4.json','data/notMNIST_xylab_cat_D.json'];// data/mn_cat_1.json
        var json_rebin_type_set = ['None','Square'];//square
        var json_rebin_size_set = ['Small','Default','Large','Auto'];
        var json_scale_set = ['Linear','Log','Square Root','Cubic Root','Equi-depth'];// Log, Square Root, Cubic Root, Equi-depth
        var json_compose_set = ['None','Max','Mean','Blend','Invmin','Weaving','Propling','Division','Separate','Time','Hatching','Glyph']; //Max, Mean, Invmin, Blend, Weaving, Propling, Division, Separate, Time
        var json_smooth_set = ['True','False'];
        var json_legend_set = ['True','False'];//False
        var json_axis_set = ['True','False'];//True


        function initThree() {
            canvas = document.getElementById("canvas-frame");
            width = document.getElementById('canvas-frame').clientWidth;
            height = document.getElementById('canvas-frame').clientHeight;
            renderer = new THREE.WebGLRenderer({
                antialias : true
            });
            renderer.setSize(width, height);
            document.getElementById('canvas-frame').appendChild(renderer.domElement);
            renderer.setClearColor(0xFFFFFF, 1.0); //

            //-----以下为图例部分-----
            canvas_legend = document.getElementById("canvas-legend");
            width_legend = document.getElementById('canvas-legend').clientWidth;
            height_legend = document.getElementById('canvas-legend').clientHeight;
            renderer_legend = new THREE.WebGLRenderer({
                antialias : true
            });
            renderer_legend.setSize(width_legend, height_legend);
            document.getElementById('canvas-legend').appendChild(renderer_legend.domElement);
            renderer_legend.setClearColor(0xFFFFFF, 1.0); //

        }

        var camera;
        var camera_legend;
        function initCamera() {
            camera = new THREE.PerspectiveCamera(45, width / height, 1, 5000);
            camera.position.x = 0;
            camera.position.y = 0;
            camera.position.z = 1700;
            camera.up.x = 0;
            camera.up.y = 1;
            camera.up.z = 0;
            camera.lookAt(0,0,0);

            camera_legend = new THREE.PerspectiveCamera(45, width_legend / height_legend, 1, 5000);
            camera_legend.position.x = 0;
            camera_legend.position.y = 0;
            camera_legend.position.z = 2000;
            camera_legend.up.x = 0;
            camera_legend.up.y = 1;
            camera_legend.up.z = 0;
            camera_legend.lookAt(0,0,0);
        }

        var scene;
        var scene_legend;
        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0xFAFAFA );//050505  FFFFFF--------背景色----------------------------
            //scene.fog = new THREE.Fog( 0x050505, 2000, 3500 );//

            scene_legend = new THREE.Scene();
            scene_legend.background = new THREE.Color( 0xFAFAFA );//--------背景色----------------------------
        }
        var light;
        var light_legend;
        function initLight() {
            light = new THREE.DirectionalLight(0xFFFFFF, 1.0, 0);
            light.position.set(0, 0, 200);
            scene.add(light);

            light_legend = new THREE.DirectionalLight(0xFFFFFF, 1.0, 0);
            light_legend.position.set(0, 0, 200);
            scene_legend.add(light_legend);
        }

        var fov = 45;//视野角
        var mouse_x = 0;
        var mouse_y = 0;
        //定义鼠标事件
        function setEventsMouse(){
            //点击了鼠标左键
            window.addEventListener( 'click', function(e){
                if(e.button===0){
                    console.log("点击了鼠标左键");
                }
            } );

            //点击了鼠标右键
            window.addEventListener( 'contextmenu', function(e){
                if(e.button===2){
                    console.log("点击了鼠标右键");
                }
            } );

            //鼠标移动坐标，2D坐标
            window.addEventListener( 'mousemove', function(e){
                mouse_x = e.x;
                mouse_y = e.y;
                // console.log('x:'+e.x);
                // console.log('y:'+e.y);
            } );
        }

        function mousewheel() {



                //监听鼠标滚动事件
                window.addEventListener('mousewheel', function (e) {
                    console.log('wheel'+e);
                    e.preventDefault();
                    //e.stopPropagation();
                    if((mouse_x>=250) && (mouse_x<=1250) && (mouse_y>=65) && (mouse_y<=900)) {
                        if (e.wheelDelta) {  //判断浏览器IE，谷歌滑轮事件
                            if (e.wheelDelta > 0) { //当滑轮向上滚动时
                                if (camera.position.z < 3000) {
                                    camera.position.z += 10;

                                    if(rebin_square_size_type === 3){
                                        if(camera.position.z > 2000 && rebin_square_size_type_auto === 1){
                                            rebin_square_size_type = 2;
                                            tile_point_size[3] = tile_point_size[2];
                                            rebin_square_size_type_auto = 2;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                        if(camera.position.z > 1000 && rebin_square_size_type_auto === 0){
                                            rebin_square_size_type = 1;
                                            tile_point_size[3] = tile_point_size[1];
                                            rebin_square_size_type_auto = 1;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                    }

                                }
                                console.log("wheelup");
                            }
                            if (e.wheelDelta < 0) { //当滑轮向下滚动时
                                if (camera.position.z > 500) {
                                    camera.position.z -= 10;

                                    if(rebin_square_size_type === 3){
                                        if(camera.position.z <900 && rebin_square_size_type_auto === 1){
                                            rebin_square_size_type = 0;
                                            tile_point_size[3] = tile_point_size[0];
                                            rebin_square_size_type_auto = 0;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                        if(camera.position.z <1900 && rebin_square_size_type_auto === 2){
                                            rebin_square_size_type = 1;
                                            tile_point_size[3] = tile_point_size[1];
                                            rebin_square_size_type_auto = 1;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                    }

                                }
                                console.log("wheeldown");
                            }
                        }
                    }
                });
                window.addEventListener('DOMMouseScroll', function (e) {
                    console.log('wheel'+e);
                    e.preventDefault();
                    if((mouse_x>=250) && (mouse_x<=1250) && (mouse_y>=65) && (mouse_y<=900)) {
                        if (e.detail) {  //Firefox滑轮事件
                            if (e.detail > 0) { //当滑轮向上滚动时
                                if (camera.position.z < 3000) {
                                    camera.position.z += 10;

                                    if(rebin_square_size_type === 3){
                                        if(camera.position.z > 2000 && rebin_square_size_type_auto === 1){
                                            rebin_square_size_type = 2;
                                            tile_point_size[3] = tile_point_size[2];
                                            rebin_square_size_type_auto = 2;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                        if(camera.position.z > 1000 && rebin_square_size_type_auto === 0){
                                            rebin_square_size_type = 1;
                                            tile_point_size[3] = tile_point_size[1];
                                            rebin_square_size_type_auto = 1;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                    }

                                }
                                console.log("wheelup " + mouse_x + ' ' + mouse_y);
                            }
                            if (e.detail < 0) { //当滑轮向下滚动时
                                if (camera.position.z > 200) {
                                    camera.position.z -= 10;

                                    if(rebin_square_size_type === 3){
                                        if(camera.position.z <900 && rebin_square_size_type_auto === 1){
                                            rebin_square_size_type = 0;
                                            tile_point_size[3] = tile_point_size[0];
                                            rebin_square_size_type_auto = 0;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                        if(camera.position.z <1900 && rebin_square_size_type_auto === 2){
                                            rebin_square_size_type = 1;
                                            tile_point_size[3] = tile_point_size[1];
                                            rebin_square_size_type_auto = 1;
                                            generate_pre();
                                            rebin_square_size_type = 3;
                                        }
                                    }

                                }
                                console.log("wheeldown");
                            }
                        }
                    }
                });


                console.log("wheel");

        }
        function calculate_max() {
            let point_max_c = [0,0,0,0];
            //清零
            point_max = 0;
            point_max_sum = 0;
            //point_max_pixel = 0;//计算在init中
            for(let c=0;c<class_num;c++){
                point_max_pixel_color[c] = 0;
            }

            for ( let i = 0; i < tile_num; i++) { //一维长度为2
                for ( let j = 0; j < tile_num; j++) { //二维长度为3
                    let temp = 0;
                    for( let z = 0; z < class_num; z++){
                        if(data_vector[i][j][z] > point_max_c[z]){//计算point_max_c[]
                            point_max_c[z] = data_vector[i][j][z];
                        }
                        temp +=data_vector[i][j][z];
                    }
                    if(temp>point_max_sum){
                        point_max_sum = temp;
                    }
                }
            }
            point_max = point_max_c[0];
            for(let i = 1; i<class_num;i++){//计算point_max
                if(point_max < point_max_c[i]){
                    point_max = point_max_c[i];
                }
            }


            for(let i = 0; i<pixel_num;i++){
                for(let j = 0; j<pixel_num; j++) {
                    for(let c=0;c<class_num;c++){
                        if(data_buffer[i][j][c] > point_max_pixel_color[c]){
                            point_max_pixel_color[c] = data_buffer[i][j][c];
                        }
                    }
                }
            }
            console.log("point_max: " + point_max + " sum: " + point_max_sum +" ( " + point_max_c[0] +" "+ point_max_c[1] +" "+ point_max_c[2] +" "+ point_max_c[3] + " ) ");

        }

        function myscale(s,domain, range,value) {
            let ret = 1;
            switch (s){
                case 0://线性
                    let scale = (range[1] - range[0])/(domain[1] - domain[0]);
                    ret = (value - domain[0]) * scale + range[0];
                    break;
                case 1://对数    domain[0]和domain[1]不能为0 ！！！
                    let base = Math.E;
                    let logBase = Math.log(base);
                    if(value === 0){
                        ret = 0;
                    }else{
                        ret = myscale(0, [Math.log(domain[0]) / logBase, Math.log(domain[1]) / logBase], range, Math.log(value) / logBase);//domain[0]和domain[1]不能为0 ！！！
                    }
                    break;
                case 2://平方根
                    let degree2 = 2;
                    ret = myscale(0, [Math.pow(domain[0], 1 / degree2), Math.pow(domain[1], 1 / degree2)], range, Math.pow(value, 1 / degree2));
                    break;
                case 3://立方根
                    let degree3 = 3;
                    ret = myscale(0, [Math.pow(domain[0], 1 / degree3), Math.pow(domain[1], 1 / degree3)], range, Math.pow(value, 1 / degree3));
                    break;
                case 4://等深线
                    let level = 4;
                    let strip = (domain[1] - domain[0]) / level;
                    let temp =Math.floor((value - domain[0]) / strip) * strip;
                    ret = myscale(0, domain, range, temp);
                    break;
            }
            return ret;
        }

        function mood_max() {
            mood = 1;

            let class_max = 0;
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            if(rebin_type === 1){
                let geometry = new THREE.BufferGeometry();
                let positions = [];
                let colors = [];
                let color = new THREE.Color();
                //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
                let position_alpha = [0,0,0];
                let color_alpha = [0,0,0];

                let n = board_length;
                let n2 = n / 2; // particles spread in the cube

                //let class_max = 0;
                let location_x = 0;
                let location_y = 0;
                let data_vector_scale = 0;
                console.log('tilenum: '+tile_num+' sidelength: '+side_length);
                for ( let i = 0; i < tile_num; i++) { //一维长度为2
                    for ( let j = 0; j < tile_num; j++) { //二维长度为3
                        class_max = 0;
                        if(data_vector[i][j][0] >= data_vector[i][j][1]){
                            class_max = 0;
                        }else{
                            class_max = 1;
                        }
                        if(data_vector[i][j][2] > data_vector[i][j][class_max]){
                            class_max = 2;
                        }
                        if(data_vector[i][j][3] > data_vector[i][j][class_max]){
                            class_max = 3;
                        }
                        location_x = i*side_length - n2 + 0.5*side_length;
                        location_y = j*side_length - n2 + 0.5*side_length;
                        //positions.push( location_x, location_y, tile_point_z );
                        // data_vector_scale = myscale(scale_type, [1,point_max], [1,point_max], data_vector[i][j][class_max]);//定义域 值域不能从0开始，否则对数比例尺无法显示！！！
                        // color.setRGB(colors_class[class_max][0] * data_vector_scale/point_max ,
                        //     colors_class[class_max][1] * data_vector_scale/point_max ,
                        //     colors_class[class_max][2] * data_vector_scale/point_max);
                        // colors.push( color.r, color.g, color.b );

                        //-----------------------------------------------------
                        position_alpha[0] = location_x;//,location_y,tile_point_z];
                        position_alpha[1] = location_y;
                        position_alpha[2] = tile_point_z;

                            data_vector_scale = myscale(scale_type, [1,point_max], [0.01,1], data_vector[i][j][class_max]);
                            // color_rs[x] = colors_class[x][0] * data_vector[i][j][x] * data_vector_scale / point_max;
                            // color_gs[x] = colors_class[x][1] * data_vector[i][j][x] * data_vector_scale / point_max;
                            // color_bs[x] = colors_class[x][2] * data_vector[i][j][x] * data_vector_scale / point_max;
                            // color_rs[x] = colors_class[x][0] ;
                            // color_gs[x] = colors_class[x][1] ;
                            // color_bs[x] = colors_class[x][2] ;
                            //color.setRGB(color_rs , color_gs , color_bs);
                            color_alpha[0] = colors_class[class_max][0];//[color.r, color.g, color.b ];
                            color_alpha[1] = colors_class[class_max][1];
                            color_alpha[2] = colors_class[class_max][2] ;

                            let geometry = new THREE.PlaneBufferGeometry(side_length-1 , side_length-1 );
                            //geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( position_alpha, 3 ) );
                            //geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( color_alpha, 3 ) );
                            //geometry.computeBoundingSphere();
                            let material = new THREE.MeshBasicMaterial();/*  {size: tile_point_size[rebin_square_size_type], vertexColors: true } */
                            // material.transparent = true;
                            // material.opacity = data_vector_scale;
                            let point = new THREE.Mesh( geometry, material );
                            point.position.set(position_alpha[0],position_alpha[1],position_alpha[2]);
                            point.material.color.setRGB(color_alpha[0],color_alpha[1],color_alpha[2]);
                            point.material.transparent = true;
                            point.material.opacity = data_vector_scale;
                            points.push(point);

                        //-----------------------------------------------------




                    }
                }
                // console.log(positions);
                // console.log(colors);
                // geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                // geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                // geometry.computeBoundingSphere();
                // let material = new THREE.PointsMaterial( { size: tile_point_size[rebin_square_size_type], vertexColors: true } );
                // material.transparent = false;
                // pointss = new THREE.Points( geometry, material );
                // points.push(pointss);
                add_allitem(scene,points);
                console.log(points);
                //scene.add( points );

            }else{//  rebin = 0;
                //let classmax = 0;
                //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
                let mult=4;
                let geometry = new THREE.BufferGeometry();
                let positions = [];
                let colors = [];
                let color = new THREE.Color();
                let color_r = new THREE.Color();
                let color_g = new THREE.Color();
                let color_b = new THREE.Color();
                let color_o = new THREE.Color();
                color_r.setRGB(1,0,0);
                color_g.setRGB(0,1,0);
                //color_g.setHex(0x005500);
                color_b.setRGB(0,0,1);
                color_o.setRGB(1,1,0);
                let data_buffer_scale = 0;
                for(let m = 0; m<pixel_num;m++){
                    for(let n = 0; n<pixel_num; n++){

                        if(data_buffer[m][n][0] > data_buffer[m][n][1]){
                            classmax = 0;
                        }else{
                            classmax = 1;
                        }
                        if(data_buffer[m][n][2] > data_buffer[m][n][classmax]){
                            classmax = 2;
                        }
                        if(data_buffer[m][n][3] > data_buffer[m][n][classmax]){
                            classmax = 3;
                        }

                        //positions.push( (m-128)*mult, (n-128)*mult, 0 );
                        data_buffer_scale = myscale(scale_type,[1,point_max_pixel],[1,50],data_buffer[m][n][classmax]);
                        // color.setRGB(colors_class[classmax][0] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[classmax][1] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[classmax][2] * data_buffer_scale/point_max_pixel);
                        // colors.push( color.r, color.g, color.b );
                        for(let t = 0;t<data_buffer_scale;t++){
                            colors.push(colors_class[classmax][0],colors_class[classmax][1],colors_class[classmax][2]);
                            positions.push( (m-128)*mult, (n-128)*mult, 0 );
                        }

                    }
                }


                geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                geometry.computeBoundingSphere();
                let material = new THREE.PointsMaterial( { size: point_size, vertexColors: true } );
                material.transparent = true;
                material.opacity = 0.02;

                pointss = new THREE.Points( geometry, material );
                points.push(pointss);
                add_allitem(scene,points);
               // scene.add( points );//原始点阵！！！！！！！！！！！！！！！！！！！！！！！！here
            }


        }
        function mood_mean() {
            mood = 2;

            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            let color_rs = [0,0,0,0];
            let color_gs = [0,0,0,0];
            let color_bs = [0,0,0,0];
            let color_r = 0;
            let color_g = 0;
            let color_b = 0;

            if(rebin_type === 1){
                //let geometry = new THREE.BufferGeometry();
                //let positions = [];
                //let colors = [];
                let color = new THREE.Color();
                // let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
                // let color_rs = [0,0,0,0];
                // let color_gs = [0,0,0,0];
                // let color_bs = [0,0,0,0];
                // let color_r = 0;
                // let color_g = 0;
                // let color_b = 0;
                let position_alpha= [0,0,0];
                let color_alpha = [0,0,0];

                let n = board_length;
                let n2 = n / 2; // particles spread in the cube

                let location_x = 0;
                let location_y = 0;
                let data_vector_scale = 0;
                for ( let i = 0; i < tile_num; i++) { //一维长度为2
                    for ( let j = 0; j < tile_num; j++) { //二维长度为3

                        location_x = i*side_length - n2 + 0.5*side_length;
                        location_y = j*side_length - n2 + 0.5*side_length;
                        //positions.push( location_x, location_y, tile_point_z );
                        let data_vector_sum = 0;
                        for(let x = 0;x<class_num;x++){
                            data_vector_sum += data_vector[i][j][x];
                        }
                        //-----------------------------------------------------
                        position_alpha[0] = location_x;//,location_y,tile_point_z];
                        position_alpha[1] = location_y;
                        position_alpha[2] = tile_point_z;
                        for(let x = 0 ; x<class_num ; x++){
                            data_vector_scale = myscale(scale_type, [1,point_max], [0.01,1], data_vector[i][j][x]);
                            // color_rs[x] = colors_class[x][0] * data_vector[i][j][x] * data_vector_scale / point_max;
                            // color_gs[x] = colors_class[x][1] * data_vector[i][j][x] * data_vector_scale / point_max;
                            // color_bs[x] = colors_class[x][2] * data_vector[i][j][x] * data_vector_scale / point_max;
                            // color_rs[x] = colors_class[x][0] ;
                            // color_gs[x] = colors_class[x][1] ;
                            // color_bs[x] = colors_class[x][2] ;
                            //color.setRGB(color_rs , color_gs , color_bs);
                            color_alpha[0] = colors_class[x][0];//[color.r, color.g, color.b ];
                            color_alpha[1] = colors_class[x][1];
                            color_alpha[2] = colors_class[x][2] ;

                            let geometry = new THREE.PlaneBufferGeometry(side_length-1 , side_length-1 );
                            //geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( position_alpha, 3 ) );
                            //geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( color_alpha, 3 ) );
                            //geometry.computeBoundingSphere();
                            let material = new THREE.MeshBasicMaterial();/*  {size: tile_point_size[rebin_square_size_type], vertexColors: true } */
                            // material.transparent = true;
                            // material.opacity = data_vector_scale;
                            let point = new THREE.Mesh( geometry, material );
                            point.position.set(position_alpha[0],position_alpha[1],position_alpha[2]);
                            point.material.color.setRGB(color_alpha[0],color_alpha[1],color_alpha[2]);
                            point.material.transparent = true;
                            point.material.opacity = data_vector_scale;
                            points.push(point);
                        }


                        //-----------------------------------------------------
                        // for(let x = 0 ; x<class_num ; x++){
                        //     data_vector_scale = myscale(scale_type, [1,point_max], [1,point_max], data_vector[i][j][x]);
                        //     // color_rs[x] = colors_class[x][0] * data_vector[i][j][x] * data_vector_scale / point_max;
                        //     // color_gs[x] = colors_class[x][1] * data_vector[i][j][x] * data_vector_scale / point_max;
                        //     // color_bs[x] = colors_class[x][2] * data_vector[i][j][x] * data_vector_scale / point_max;
                        //     color_rs[x] = colors_class[x][0] * data_vector_scale / point_max;
                        //     color_gs[x] = colors_class[x][1] * data_vector_scale / point_max;
                        //     color_bs[x] = colors_class[x][2] * data_vector_scale / point_max;
                        // }
                        // for (let x = 0 ; x<class_num ; x++){
                        //     color_r += color_rs[x];
                        //     color_g += color_gs[x];
                        //     color_b += color_bs[x];
                        // }
                        // // color_r = color_r/(data_vector_sum);//*4
                        // // color_g = color_g/(data_vector_sum);
                        // // color_b = color_b/(data_vector_sum);
                        // color_r = color_r/class_num;
                        // color_g = color_g/class_num;
                        // color_b = color_b/class_num;
                        // color.setRGB(color_r , color_g , color_b);
                        // colors.push( color.r, color.g, color.b );

                    }
                }
                // geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                // geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                // geometry.computeBoundingSphere();
                // let material = new THREE.PointsMaterial( { size: tile_point_size[rebin_square_size_type], vertexColors: true } );
                // material.transparent = false;
                // pointss = new THREE.Points( geometry, material );
                // points.push(pointss);
                add_allitem(scene,points);
                //scene.add( points );

            }else{
                let mult=4;
                let geometry = new THREE.BufferGeometry();
                let positions = [];
                let colors = [];
                let color = new THREE.Color();
                // let color_r = new THREE.Color();
                // let color_g = new THREE.Color();
                // let color_b = new THREE.Color();
                // let color_o = new THREE.Color();
                // color_r.setRGB(1,0,0);
                // color_g.setRGB(0,1,0);
                // //color_g.setHex(0x005500);
                // color_b.setRGB(0,0,1);
                // color_o.setRGB(1,1,0);
                let position_alpha = [0,0,0];
                let color_alpha = [0,0,0];
                let opacitys = [];


                let data_buffer_scale = 0;
                for(let i = 0; i<pixel_num;i++){
                    for(let j = 0; j<pixel_num; j++){

                        let data_buffer_sum = 1;
                        for(let x = 0;x<class_num;x++){
                            data_buffer_sum += data_buffer[i][j][x];
                        }

                        //positions.push( (i-128)*mult, (j-128)*mult, 0 );


                        for(let x = 0 ; x<class_num ; x++){
                            // data_buffer_scale = myscale(scale_type, [1,point_max_pixel_color[x]], [1,point_max_pixel_color[x]], data_buffer[i][j][x]);
                            // // color_rs[x] = colors_class[x][0] * data_buffer[i][j][x] * data_buffer_scale / point_max_pixel_color[x] ;
                            // // color_gs[x] = colors_class[x][1] * data_buffer[i][j][x] * data_buffer_scale / point_max_pixel_color[x];//point_max_pixel
                            // // color_bs[x] = colors_class[x][2] * data_buffer[i][j][x] * data_buffer_scale / point_max_pixel_color[x];
                            // color_rs[x] = colors_class[x][0] *  data_buffer_scale / point_max_pixel ;
                            // color_gs[x] = colors_class[x][1] *  data_buffer_scale / point_max_pixel;//point_max_pixel
                            // color_bs[x] = colors_class[x][2] *  data_buffer_scale / point_max_pixel;
                            //-----------------
                            data_buffer_scale = myscale(scale_type, [1,point_max_pixel_color[x]], [1,50], data_buffer[i][j][x]);
                            for(let t = 0;t<data_buffer_scale;t++){
                                colors.push(colors_class[x][0],colors_class[x][1],colors_class[x][2]);
                                positions.push( (i-128)*mult, (j-128)*mult, 0 );
                                //opacitys.push(data_buffer_scale);
                            }


                            // let geometry = new THREE.Geometry();
                            // let material = new THREE.PointsMaterial( { size: point_size, vertexColors: true } );
                            // material.transparent = false;
                            // //material.opacity = data_buffer_scale;
                            // let point = new THREE.Points( geometry, material );
                            // point.position.set( (i-128)*mult, (j-128)*mult, 0);
                            // point.material.color.setRGB(colors_class[x][0],colors_class[x][1],colors_class[x][2]);
                            // points.push(point);

                            //-----------------
                        }
                        // for (let x = 0 ; x<class_num ; x++){
                        //     color_r += color_rs[x];
                        //     color_g += color_gs[x];
                        //     color_b += color_bs[x];
                        // }
                        //
                        // // color_r = color_r/(data_buffer_sum);//*4
                        // // color_g = color_g/(data_buffer_sum);
                        // // color_b = color_b/(data_buffer_sum);
                        // color_r = color_r/class_num;
                        // color_g = color_g/class_num;
                        // color_b = color_b/class_num;
                        //
                        // color.setRGB(color_r , color_g , color_b);
                        // colors.push( color.r, color.g, color.b );

                    }
                }

                console.log(colors);
                geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                geometry.computeBoundingSphere();
                let material = new THREE.PointsMaterial( { size: point_size, vertexColors: true } );
                material.transparent = true;
                //material.setAttribute('opacity', new THREE.Float32BufferAttribute( opacitys, 1 ) );
                material.opacity = 0.02;//50个档位

                let pointss = new THREE.Points( geometry, material );
                //pointss.setAttribute('opacity', new THREE.Float32BufferAttribute( opacitys, 1 ) );
                points.push(pointss);
                //console.log(points);
                // points.map(function (item,index,ary ) {
                //     return item.material.opacity = opacitys[index];
                // });

                add_allitem(scene,points);
                //scene.add( points );//原始点阵！！！！！！！！！！！！！！！！！！！！！！！！here
            }


        }
        function mood_blend() {//不考虑数量的求平均
            mood = 3;

            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            let color_rs = [0,0,0,0];
            let color_gs = [0,0,0,0];
            let color_bs = [0,0,0,0];
            let color_r = 0;
            let color_g = 0;
            let color_b = 0;

            if(rebin_type === 1){
                let geometry = new THREE.BufferGeometry();
                let positions = [];
                let colors = [];
                let color = new THREE.Color();
                // let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
                // let color_rs = [0,0,0,0];
                // let color_gs = [0,0,0,0];
                // let color_bs = [0,0,0,0];
                // let color_r = 0;
                // let color_g = 0;
                // let color_b = 0;

                let n = board_length;
                let n2 = n / 2; // particles spread in the cube

                let location_x = 0;
                let location_y = 0;
                let data_vector_scale = 0;
                for ( let i = 0; i < tile_num; i++) { //一维长度为2
                    for ( let j = 0; j < tile_num; j++) { //二维长度为3

                        location_x = i*side_length - n2 + 0.5*side_length;
                        location_y = j*side_length - n2 + 0.5*side_length;
                        positions.push( location_x, location_y, tile_point_z );
                        //let data_vector_sum = 0;

                        for(let x = 0 ; x<class_num ; x++){
                            data_vector_scale = myscale(scale_type, [1,point_max], [1,point_max], data_vector[i][j][x]);
                            color_rs[x] = colors_class[x][0] * data_vector_scale / (point_max);
                            color_gs[x] = colors_class[x][1] * data_vector_scale / (point_max);
                            color_bs[x] = colors_class[x][2] * data_vector_scale / (point_max);
                        }
                        for (let x = 0 ; x<class_num ; x++){
                            color_r += color_rs[x];
                            color_g += color_gs[x];
                            color_b += color_bs[x];
                        }
                        // color_r = color_r/class_num;
                        // color_g = color_g/class_num;
                        // color_b = color_b/class_num;
                        color.setRGB(color_r , color_g , color_b);
                        colors.push( color.r, color.g, color.b );

                    }
                }
                geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                geometry.computeBoundingSphere();
                let material = new THREE.PointsMaterial( { size: tile_point_size[rebin_square_size_type], vertexColors: true } );
                material.transparent = false;
                pointss = new THREE.Points( geometry, material );
                points.push(pointss);
                add_allitem(scene,points);
                //scene.add( points );

            }else{
                let mult=4;
                let geometry = new THREE.BufferGeometry();
                let positions = [];
                let colors = [];
                let color = new THREE.Color();
                // let color_r = new THREE.Color();
                // let color_g = new THREE.Color();
                // let color_b = new THREE.Color();
                // let color_o = new THREE.Color();
                // color_r.setRGB(1,0,0);
                // color_g.setRGB(0,1,0);
                // //color_g.setHex(0x005500);
                // color_b.setRGB(0,0,1);
                // color_o.setRGB(1,1,0);


                let data_buffer_scale = 0;
                for(let i = 0; i<pixel_num;i++){
                    for(let j = 0; j<pixel_num; j++){

                        let data_buffer_sum = 0;
                        for(let x = 0;x<class_num;x++){
                            data_buffer_sum += data_buffer[i][j][x];
                        }

                        positions.push( (i-128)*mult, (j-128)*mult, 0 );

                        for(let x = 0 ; x<class_num ; x++){
                            data_buffer_scale = myscale(scale_type, [1,point_max_pixel_color[x]], [1,point_max_pixel_color[x]], data_buffer[i][j][x]);
                            color_rs[x] = colors_class[x][0] *  data_buffer_scale / point_max_pixel_color[x] ;
                            color_gs[x] = colors_class[x][1] *  data_buffer_scale / point_max_pixel_color[x];//point_max_pixel
                            color_bs[x] = colors_class[x][2] *  data_buffer_scale / point_max_pixel_color[x];
                        }
                        for (let x = 0 ; x<class_num ; x++){
                            color_r += color_rs[x];
                            color_g += color_gs[x];
                            color_b += color_bs[x];
                        }
                        // color_r = color_r/class_num;
                        // color_g = color_g/class_num;
                        // color_b = color_b/class_num;
                        color.setRGB(color_r , color_g , color_b);
                        colors.push( color.r, color.g, color.b );
                    }
                }
                console.log(colors);
                geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                geometry.computeBoundingSphere();
                let material = new THREE.PointsMaterial( { size: point_size, vertexColors: true } );
                material.transparent = false;
                //material.opacity = 0.9;

                pointss = new THREE.Points( geometry, material );
                points.push(pointss);
                add_allitem(scene,points);
                //scene.add( points );//原始点阵！！！！！！！！！！！！！！！！！！！！！！！！here
            }


        }
        function mood_invmin() {
            mood = 4;

            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            if(rebin_type === 1){
                let geometry = new THREE.BufferGeometry();
                let positions = [];
                let colors = [];
                let color = new THREE.Color();
                //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];

                let n = board_length;
                let n2 = n / 2; // particles spread in the cube

                let class_min = 0;
                let location_x = 0;
                let location_y = 0;
                let data_vector_scale = 0;
                for ( let i = 0; i < tile_num; i++) { //一维长度为2
                    for ( let j = 0; j < tile_num; j++) { //二维长度为3
                        class_min = -1; //找到最小的非零类
                        if(data_vector[i][j][0] <= data_vector[i][j][1]){
                            if(data_vector[i][j][0] > 0){
                                class_min = 0;
                            }
                        }else{
                            if(data_vector[i][j][1] > 0){
                                class_min = 1;
                            }
                        }
                        if(class_min === -1){
                            if(data_vector[i][j][2] < data_vector[i][j][3]){
                                if(data_vector[i][j][2] > 0){
                                    class_min = 2;
                                }
                            }else{
                                if(data_vector[i][j][3] > 0){
                                    class_min = 3;
                                }
                            }
                        }else{
                            if(data_vector[i][j][2] < data_vector[i][j][class_min]){
                                if(data_vector[i][j][2] > 0){
                                    class_min = 2;
                                }
                            }
                            if(data_vector[i][j][3] < data_vector[i][j][class_min]){
                                if(data_vector[i][j][3] > 0){
                                    class_min = 3;
                                }
                            }
                        }

                        location_x = i*side_length - n2 + 0.5*side_length;
                        location_y = j*side_length - n2 + 0.5*side_length;
                        //positions.push( location_x, location_y, tile_point_z );

                        if(class_min === -1 || data_vector[i][j][class_min] === 0){
                            color.setRGB(0,0,0);
                            colors.push( color.r, color.g, color.b );
                        }else{
                            data_vector_scale = myscale(scale_type,[1,point_max],[50,1],data_vector[i][j][class_min]);
                            // color.setRGB(colors_class[class_min][0] * (1 - data_vector_scale/point_max ),// (1 - data_vector[i][j][class_min]/point_max
                            //     colors_class[class_min][1] * (1 - data_vector_scale/point_max) ,
                            //     colors_class[class_min][2] * (1 - data_vector_scale/point_max));
                            //colors.push( color.r, color.g, color.b );

                            for(let t = 0;t<data_vector_scale;t++){
                                colors.push(colors_class[class_min][0],colors_class[class_min][1],colors_class[class_min][2]);
                                positions.push( location_x, location_y, tile_point_z );
                                //opacitys.push(data_buffer_scale);
                            }
                        }


                    }
                }
                geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                geometry.computeBoundingSphere();
                let material = new THREE.PointsMaterial( { size: tile_point_size[rebin_square_size_type], vertexColors: true } );
                material.transparent = true;
                material.opacity = 0.02;
                pointss = new THREE.Points( geometry, material );
                points.push(pointss);
                add_allitem(scene,points);
                //scene.add( points );

            }else{
                let mult=4;
                let geometry = new THREE.BufferGeometry();
                let positions = [];
                let colors = [];
                let color = new THREE.Color();
                let color_r = new THREE.Color();
                let color_g = new THREE.Color();
                let color_b = new THREE.Color();
                let color_o = new THREE.Color();
                color_r.setRGB(1,0,0);
                color_g.setRGB(0,1,0);
                //color_g.setHex(0x005500);
                color_b.setRGB(0,0,1);
                color_o.setRGB(1,1,0);
                let classmin = 0;
                let data_buffer_scale = 0;
                for(let m = 0; m<pixel_num;m++){
                    for(let n = 0; n<pixel_num; n++){
                        classmin = 0;
                        if(data_buffer[m][n][0] <= data_buffer[m][n][1]){
                            classmin = 0;
                        }else{
                            classmin = 1;
                        }
                        if(data_buffer[m][n][2] < data_buffer[m][n][classmin]){
                            classmin = 2;
                        }
                        if(data_buffer[m][n][3] < data_buffer[m][n][classmin]){
                            classmin = 3;
                        }
                        if (data_buffer[m][n][classmin] === 0){
                            positions.push( (m-128)*mult, (n-128)*mult, 0 );
                            color.setRGB(0,0,0);
                            colors.push( color.r, color.g, color.b );
                        }else{
                            //positions.push( (m-128)*mult, (n-128)*mult, 0 );
                            data_buffer_scale = myscale(scale_type,[1,point_max_pixel],[50,1],data_buffer[m][n][classmin]);
                            // color.setRGB(colors_class[classmin][0] * (1 - data_buffer_scale/point_max_pixel) ,
                            //     colors_class[classmin][1] * (1 - data_buffer_scale/point_max_pixel) ,
                            //     colors_class[classmin][2] * (1 - data_buffer_scale/point_max_pixel));
                            // colors.push( color.r, color.g, color.b );
                            for(let t = 0;t<data_buffer_scale;t++){
                                colors.push(colors_class[classmin][0],colors_class[classmin][1],colors_class[classmin][2]);
                                positions.push( (m-128)*mult, (n-128)*mult, tile_point_z );
                                //opacitys.push(data_buffer_scale);
                            }
                        }


                    }
                }


                geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                geometry.computeBoundingSphere();
                let material = new THREE.PointsMaterial( { size: point_size, vertexColors: true } );
                material.transparent = true;
                material.opacity = 0.02;

                pointss = new THREE.Points( geometry, material );
                points.push(pointss);
                add_allitem(scene,points);
               // scene.add( points );//原始点阵！！！！！！！！！！！！！！！！！！！！！！！！here

            }


        }

        function mood_weaving() {
            mood = 5;
            var weaving_box_size = side_length/4;

            let geometry = new THREE.BufferGeometry();
            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            let position_alpha = [0,0,0];
            let color_alpha = [0,0,0];

            let color_class = 0;
            let i = 0, j = 0;
            let data_vector_scale = 0;
            for(let x = (-board_length + weaving_box_size)/2, m = 0 ; x < (board_length + weaving_box_size)/2; x += weaving_box_size, m++){
                for(let y = (-board_length + weaving_box_size)/2, n = 0 ; y < (board_length + weaving_box_size)/2; y += weaving_box_size, n++){
                    //positions.push( x, y, tile_point_z );
                    color_class = (m + n) % 4;
                    i = Math.floor(m/4);
                    j = Math.floor(n/4);
                    //data_vector_scale = myscale(scale_type, [1,point_max], [1,point_max], data_vector[i][j][color_class]);
                    // color.setRGB(colors_class[color_class][0] * data_vector_scale/point_max ,
                    //     colors_class[color_class][1] * data_vector_scale/point_max ,
                    //     colors_class[color_class][2] * data_vector_scale/point_max);
                    // colors.push( color.r, color.g, color.b );

                    //-----------------------------------------------------
                    position_alpha[0] = x;//,location_y,tile_point_z];
                    position_alpha[1] = y;
                    position_alpha[2] = tile_point_z;
                    //for(let x = 0 ; x<class_num ; x++){
                        data_vector_scale = myscale(scale_type, [1,point_max], [0.01,1], data_vector[i][j][color_class]);

                        color_alpha[0] = colors_class[color_class][0];//[color.r, color.g, color.b ];
                        color_alpha[1] = colors_class[color_class][1];
                        color_alpha[2] = colors_class[color_class][2] ;

                        let geometry = new THREE.PlaneBufferGeometry((side_length-1)/(side_length/weaving_box_size) , (side_length-1)/(side_length/weaving_box_size) );

                        let material = new THREE.MeshBasicMaterial();/*  {size: tile_point_size[rebin_square_size_type], vertexColors: true } */

                        let point = new THREE.Mesh( geometry, material );
                        point.position.set(position_alpha[0],position_alpha[1],position_alpha[2]);
                        point.material.color.setRGB(color_alpha[0],color_alpha[1],color_alpha[2]);
                        point.material.transparent = true;
                        point.material.opacity = data_vector_scale;
                        points.push(point);
                  //  }
                    //-----------------------------------------------------

                }
            }

            // geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
            // geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
            // geometry.computeBoundingSphere();
            // let material = new THREE.PointsMaterial( { size: tile_point_size[rebin_square_size_type]/(side_length/weaving_box_size), vertexColors: true } );
            // material.transparent = false;
            // pointss = new THREE.Points( geometry, material );
            // points.push(pointss);
            add_allitem(scene,points);
            //scene.add( points );

        }
        function mood_propline() {
            mood = 6;
            var propline_sort = 0;
            var propline_colprop = 1;
            var propline_percent = 0;

            let plane_weight = side_length / 4 - 1;
            let plane_height = side_length - 1;
            let plane_depth = side_length;

            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            let position_alpha = [0,0,0];
            let color_alpha = [0,0,0];

            let n = board_length;
            let n2 = n / 2; // particles spread in the cube

            let class_max = 0;
            let location_x = 0;
            let location_y = 0;
            let data_vector_scale = 0;
            // let geometry = new THREE.PlaneBufferGeometry(plane_weight, plane_height );
            // let material = new THREE.MeshBasicMaterial();//{vertexColors: true}
            //pointss = new THREE.Mesh(geometry,material);
            for ( let i = 0; i < tile_num; i++) { //一维长度为2
                for ( let j = 0; j < tile_num; j++) { //二维长度为3

                    console.log('for ');
                    if(propline_percent === 0){
                        if(propline_colprop === 1){
                            for(let c = 0; c < class_num; c++){
                                //console.log('if ');
                                location_x = i*side_length - n2 + 0.25*c*side_length + side_length/8;
                                location_y = j*side_length - n2 + 0.5*side_length;
                                // positions.push( location_x, location_y, tile_point_z +64);
                                // color.setRGB(colors_class[c][0] * data_vector_scale/point_max ,
                                //     colors_class[c][1] * data_vector_scale/point_max ,
                                //     colors_class[c][2] * data_vector_scale/point_max);
                                // colors.push( color.r, color.g, color.b );

                                let geometry = new THREE.PlaneBufferGeometry(plane_weight, plane_height );
                                let material = new THREE.MeshBasicMaterial();//{vertexColors: true}
                                material.transparent = false;
                                let point = new THREE.Mesh(geometry,material);
                                point.position.set(location_x, location_y, tile_point_z);
                                data_vector_scale = myscale(scale_type, [1,point_max], [0.01,1], data_vector[i][j][c]);
                                // point.material.color.setRGB(colors_class[c][0] * data_vector_scale/point_max ,
                                //     colors_class[c][1] * data_vector_scale/point_max ,
                                //     colors_class[c][2] * data_vector_scale/point_max);
                                point.material.color.setRGB(colors_class[c][0],colors_class[c][1],colors_class[c][2]);
                                point.material.transparent = true;
                                point.material.opacity = data_vector_scale;
                                //rect.material.color.setRGB(1,0,0);
                                points.push(point);
                                //scene.add(points);
                            }

                        }
                    }


                }
            }
            //scene.add(points);
            add_allitem(scene,points);

        }
        function mood_division() {
            mood = 7;
            var weaving_box_size = side_length/2;

            let geometry = new THREE.BufferGeometry();
            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            let position_alpha = [0,0,0];
            let color_alpha = [0,0,0];
            let color_class = 0;
            let i = 0, j = 0;
            let data_vector_scale = 0;
            for(let x = (-board_length + weaving_box_size)/2, m = 0 ; x < (board_length + weaving_box_size)/2; x += weaving_box_size, m++){
                for(let y = (-board_length + weaving_box_size)/2, n = 0 ; y < (board_length + weaving_box_size)/2; y += weaving_box_size, n++){
                    //positions.push( x, y, tile_point_z );
                    color_class = (m%2) + 2*(n%2);
                    i = Math.floor(m/2);
                    j = Math.floor(n/2);
                    //data_vector_scale = myscale(scale_type, [1,point_max], [1,point_max], data_vector[i][j][color_class]);
                    // color.setRGB(colors_class[color_class][0] * data_vector_scale/point_max ,
                    //     colors_class[color_class][1] * data_vector_scale/point_max ,
                    //     colors_class[color_class][2] * data_vector_scale/point_max);
                    // colors.push( color.r, color.g, color.b );

                    //-----------------------------------------------------
                    position_alpha[0] = x;//,location_y,tile_point_z];
                    position_alpha[1] = y;
                    position_alpha[2] = tile_point_z;
                    for(let x = 0 ; x<class_num ; x++){
                        data_vector_scale = myscale(scale_type, [1,point_max], [0.01,1], data_vector[i][j][color_class]);

                        color_alpha[0] = colors_class[color_class][0];//[color.r, color.g, color.b ];
                        color_alpha[1] = colors_class[color_class][1];
                        color_alpha[2] = colors_class[color_class][2] ;

                        let geometry = new THREE.PlaneBufferGeometry((side_length-1)/(side_length/weaving_box_size) , (side_length-1)/(side_length/weaving_box_size) );

                        let material = new THREE.MeshBasicMaterial();/*  {size: tile_point_size[rebin_square_size_type], vertexColors: true } */

                        let point = new THREE.Mesh( geometry, material );
                        point.position.set(position_alpha[0],position_alpha[1],position_alpha[2]);
                        point.material.color.setRGB(color_alpha[0],color_alpha[1],color_alpha[2]);
                        point.material.transparent = true;
                        point.material.opacity = data_vector_scale;
                        points.push(point);
                    }
                    //-----------------------------------------------------

                }
            }

            // geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
            // geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
            // geometry.computeBoundingSphere();
            // let material = new THREE.PointsMaterial( { size: tile_point_size[rebin_square_size_type]/(side_length/weaving_box_size), vertexColors: true } );
            // material.transparent = false;
            // pointss = new THREE.Points( geometry, material );
            // points.push(pointss);
            add_allitem(scene,points);
            //scene.add( points );

        }
        function mood_separate() {
            mood = 8;
            let geometry = new THREE.BufferGeometry();
            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];

            let n = board_length;
            let n2 = n / 2; // particles spread in the cube

            let c = 0;
            let location_x = 0;
            let location_y = 0;
            let data_buffer_scale = 0;
            for ( let i = 0; i < pixel_num; i++) { //一维长度为2
                for ( let j = 0; j < pixel_num; j++) { //二维长度为3

                        c = 0;
                        location_x = 2*i - n2 ;
                        location_y = 2*j - n2 ;
                        //positions.push( location_x, location_y, tile_point_z );
                        data_buffer_scale = myscale(scale_type, [1,point_max_pixel], [1,50], data_buffer[i][j][c]);
                        // color.setRGB(colors_class[c][0] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][1] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][2] * data_buffer_scale/point_max_pixel);
                        // colors.push( color.r, color.g, color.b );
                    for(let t = 0;t<data_buffer_scale;t++){
                        colors.push(colors_class[c][0],colors_class[c][1],colors_class[c][2]);
                        positions.push( location_x,location_y, tile_point_z );
                    }

                        c = 1;
                        location_x = 2*i ;
                        location_y = 2*j - n2 ;
                        data_buffer_scale = myscale(scale_type, [1,point_max_pixel], [1,50], data_buffer[i][j][c]);
                        // positions.push( location_x, location_y, tile_point_z );
                        // color.setRGB(colors_class[c][0] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][1] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][2] * data_buffer_scale/point_max_pixel);
                        // colors.push( color.r, color.g, color.b );
                    for(let t = 0;t<data_buffer_scale;t++){
                        colors.push(colors_class[c][0],colors_class[c][1],colors_class[c][2]);
                        positions.push( location_x,location_y, tile_point_z );
                    }

                        c = 2;
                        location_x = 2*i - n2 ;
                        location_y = 2*j ;
                        data_buffer_scale = myscale(scale_type, [1,point_max_pixel], [1,50], data_buffer[i][j][c]);
                        // positions.push( location_x, location_y, tile_point_z );
                        // color.setRGB(colors_class[c][0] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][1] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][2] * data_buffer_scale/point_max_pixel);
                        // colors.push( color.r, color.g, color.b );
                    for(let t = 0;t<data_buffer_scale;t++){
                        colors.push(colors_class[c][0],colors_class[c][1],colors_class[c][2]);
                        positions.push( location_x,location_y, tile_point_z );
                    }

                        c = 3;
                        location_x = 2*i ;
                        location_y = 2*j ;
                        data_buffer_scale = myscale(scale_type, [1,point_max_pixel], [1,50], data_buffer[i][j][c]);
                        // positions.push( location_x, location_y, tile_point_z );
                        // color.setRGB(colors_class[c][0] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][1] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[c][2] * data_buffer_scale/point_max_pixel);
                        // colors.push( color.r, color.g, color.b );
                    for(let t = 0;t<data_buffer_scale;t++){
                        colors.push(colors_class[c][0],colors_class[c][1],colors_class[c][2]);
                        positions.push( location_x,location_y, tile_point_z );
                    }
                }
            }
            geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
            geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
            geometry.computeBoundingSphere();
            let material = new THREE.PointsMaterial( { size: 4, vertexColors: true } );
            material.transparent = true;
            material.opacity = 0.02;
            pointss = new THREE.Points( geometry, material );
            points.push(pointss);
            add_allitem(scene,points);
            //scene.add( points );

            //加入中间十字分割线
            let geometry_slinep = new THREE.Geometry();
            geometry_slinep.vertices.push( new THREE.Vector3( -512, 0, 5 ) );
            geometry_slinep.vertices.push( new THREE.Vector3( 512, 0, 5 ) );

            var geometry_sline1 = new THREE.Line( geometry_slinep, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            scene.add( geometry_sline1 );

            var geometry_sline2 = new THREE.Line( geometry_slinep, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            geometry_sline2.rotation.z = Math.PI/2;
            scene.add( geometry_sline2 );

        }
        
        var time_c = 0;
        var time_tiems = 0;
        function mood_time() {
            //delete_allitem(points);

            //scene.remove(points);
            delete_item(points);
            remove_allitem(scene,points);
            mood = 9;
            let geometry = new THREE.BufferGeometry();
            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];

            let n = board_length;
            let n2 = n / 2; // particles spread in the cube


            let location_x = 0;
            let location_y = 0;
            let data_buffer_scale = 0;
            //for(let c = 0;c<class_num;c++){
                for ( let i = 0; i < pixel_num; i++) { //一维长度为2
                    for ( let j = 0; j < pixel_num; j++) { //二维长度为3

                        location_x = 4*i - n2 ;
                        location_y = 4*j - n2 ;
                        //positions.push( location_x, location_y, tile_point_z );
                        data_buffer_scale = myscale(scale_type, [1,point_max_pixel], [1,50], data_buffer[i][j][time_c]);
                        // color.setRGB(colors_class[time_c][0] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[time_c][1] * data_buffer_scale/point_max_pixel ,
                        //     colors_class[time_c][2] * data_buffer_scale/point_max_pixel);
                        // colors.push( color.r, color.g, color.b );
                        for(let t = 0;t<data_buffer_scale;t++){
                            colors.push(colors_class[time_c][0],colors_class[time_c][1],colors_class[time_c][2]);
                            positions.push( location_x,location_y, tile_point_z );
                        }

                    }
                }
                console.log('c = ' + time_c);
                geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
                geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
                geometry.computeBoundingSphere();
                let material = new THREE.PointsMaterial( { size: point_size, vertexColors: true } );
                material.transparent = true;
                material.opacity = 0.02;
                pointss = new THREE.Points( geometry, material );
                points.push(pointss);
                add_allitem(scene,points);
                //scene.add( points );

           // }
            time_c = (time_c+1)%4;
            time_tiems = time_tiems + 1;
            if(time_tiems < 8){

                setTimeout("mood_time()","1000");
            }else{
                time_tiems = 0;
            }


        }
        function mood_hatching() {
            mood = 10;

            // let angles = [1/2, 1, 2,8];
            let hatching_weight_max = side_length;
            let hatching_rate = [0,1,2,3] ;//[-1,-1,-1,-1] [0,0,0,0]
            let hatching_rate_data = [0,0,0,0];


            let plane_weight = side_length / 4 - 1;
            let plane_height = side_length - 1;
            let plane_depth = side_length;

            let geometry = new THREE.BufferGeometry();
            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];

            let n = board_length;
            let n2 = n / 2; // particles spread in the cube

            let class_max = 0;
            let location_x = 0;
            let location_y = 0;
            let data_vector_scale = 0;
            // let geometry = new THREE.PlaneBufferGeometry(plane_weight, plane_height );
            // let material = new THREE.MeshBasicMaterial();//{vertexColors: true}
            //pointss = new THREE.Mesh(geometry,material);
            for ( let i = 0; i < tile_num; i++) { //一维长度为2
                for ( let j = 0; j < tile_num; j++) { //二维长度为3
                    //------------排序-------------
                    for(let c=0;c<class_num;c++){
                        hatching_rate_data[c] = data_vector[i][j][c];
                        hatching_rate[c] = c;
                    }


                    for(let a = 0;a<class_num-1;a++){
                        let temp = a;
                        for(let b=a+1; b<class_num; b++){
                            if(hatching_rate_data[b] > hatching_rate_data[temp]){
                                temp = b;
                            }
                        }
                        if(temp !== a){
                            let tt = hatching_rate_data[a];
                            hatching_rate_data[a] = hatching_rate_data[temp];
                            hatching_rate_data[temp] = tt;

                            let ttt = hatching_rate[a];
                            hatching_rate[a] = hatching_rate[temp];
                            hatching_rate[temp] = ttt;
                        }
                    }
                    //-----------排序结束-------------


                    console.log('for ');

                    for(let c = 0; c < class_num; c++){//这里c是排名，cc是相应排名的颜色序号
                        //console.log('if ');
                        let cc = hatching_rate[c];
                        data_vector_scale = myscale(scale_type, [1,point_max], [1,side_length/2], data_vector[i][j][cc]);

                        for(let a =0;a<data_vector_scale;a++){
                            let angle_cc = angles[cc];
                            for(let b = 0 , bb = 0;b<side_length;b=b+angle_cc , bb++){

                                location_x = i*side_length - n2 + a + bb;
                                location_y = j*side_length - n2 + b;

                                if(location_x <= (i+1)*side_length - n2 ){
                                    positions.push( location_x, location_y, tile_point_z );
                                    color.setRGB(colors_class[cc][0],colors_class[cc][1],colors_class[cc][2]);
                                    colors.push( color.r, color.g, color.b );
                                }
                                if(angle_cc>1){
                                    for(let b2 = 0;b2<angle_cc-1;b2++){
                                        location_x = i*side_length - n2 + a + bb;
                                        location_y = j*side_length - n2 + b +b2 +1;
                                        if(location_x <= (i+1)*side_length - n2 ){
                                            if(location_y <= (j+1)*side_length - n2){
                                                positions.push( location_x, location_y, tile_point_z );
                                                color.setRGB(colors_class[cc][0],colors_class[cc][1],colors_class[cc][2]);
                                                colors.push( color.r, color.g, color.b );
                                            }

                                        }
                                    }
                                }


                            }
                        }

                    }


                }
            }
            geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
            geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
            geometry.computeBoundingSphere();
            let material = new THREE.PointsMaterial( { size: 5, vertexColors: true } );
            material.transparent = false;
            //material.opacity = 0.9;

            pointss = new THREE.Points( geometry, material );
            points.push(pointss);
            //scene.add(points);
            add_allitem(scene,points);

        }

        function mood_glyph() {
            mood = 11;

            let plane_weight = side_length / 4 - 1;
            let plane_height = side_length - 1;
            let plane_depth = side_length;

            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];

            let n = board_length;
            let n2 = n / 2; // particles spread in the cube

            // let class_max = 0;
            let location_x = 0;
            let location_y = 0;
            let data_vector_scale = 0;
            // let geometry = new THREE.PlaneBufferGeometry(plane_weight, plane_height );
            // let material = new THREE.MeshBasicMaterial();//{vertexColors: true}
            //pointss = new THREE.Mesh(geometry,material);
            for ( let i = 0; i < tile_num; i++) { //一维长度为2
                for ( let j = 0; j < tile_num; j++) { //二维长度为3

                    console.log('for ');

                    for(let c = 0; c < class_num; c++){
                        //console.log('if ');

                        // positions.push( location_x, location_y, tile_point_z +64);
                        // color.setRGB(colors_class[c][0] * data_vector_scale/point_max ,
                        //     colors_class[c][1] * data_vector_scale/point_max ,
                        //     colors_class[c][2] * data_vector_scale/point_max);
                        // colors.push( color.r, color.g, color.b );

                        data_vector_scale = myscale(scale_type, [1,point_max], [1,plane_height], data_vector[i][j][c]);
                        location_x = i*side_length - n2 + 0.25*c*side_length + side_length/8;
                        location_y = j*side_length - n2 + 0.5*data_vector_scale;

                        let geometry = new THREE.PlaneBufferGeometry(plane_weight, data_vector_scale );
                        let material = new THREE.MeshBasicMaterial();//{vertexColors: true}
                        material.transparent = false;

                        let point = new THREE.Mesh(geometry,material);
                        point.position.set(location_x, location_y, tile_point_z);

                        point.material.color.setRGB(colors_class[c][0] , colors_class[c][1] , colors_class[c][2] );
                        //rect.material.color.setRGB(1,0,0);
                        points.push(point);
                        //scene.add(points);
                    }


                }
            }
            //scene.add(points);
            add_allitem(scene,points);

        }


        var legend_show_if = 0;//判断之前是否显示了图例
        var sublegend_x1;//比例尺图例中间的小竖线
        var sublegend_x2;
        var sublegend_x3;
        function show_legend() {
            //scene_legend.remove(legends);
            //----分类的图例----
            console.log('show legend');
            if (legend_show_if === 1){
                remove_allitem(scene_legend,legends);
                delete_allitem(legends);
            }


            let geometry_c = new THREE.BufferGeometry();
            let positions_c = [];
            let colors_c = [];
            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];

            let location_x = 0;
            let location_y = 0;

            for(let i = 0;i<class_num;i++){
                console.log('for '+i);

                location_x = -600;
                location_y = 550 - 150*i;
                positions_c.push( location_x, location_y, tile_point_z );
                color.setRGB(colors_class[i][0],colors_class[i][1],colors_class[i][2]);
                console.log('color '+colors_class[i][0]+colors_class[i][1]+colors_class[i][2]);
                colors_c.push( color.r, color.g, color.b );
            }
            geometry_c.setAttribute( 'position', new THREE.Float32BufferAttribute( positions_c, 3 ) );
            geometry_c.setAttribute( 'color', new THREE.Float32BufferAttribute( colors_c, 3 ) );
            geometry_c.computeBoundingSphere();
            let material_c = new THREE.PointsMaterial( { size: 200, vertexColors: true } );
            material_c.transparent = false;
            legends_c = new THREE.Points( geometry_c, material_c );

            //scene_legend.add( legends_c );
            legends.push(legends_c);

            //----比例尺的图例----


            let positions_s = [];
            let colors_s = [];
            var legends_s;

            let legend_scale_length = 800;
            let legend_scale_ratio = 0;

            for(let i = 0;i<class_num;i++){
                for(let j = 0; j< legend_scale_length;j++){

                    location_x = -200 + j;
                    location_y = 550 - 150*i;

                    let geometry_s = new THREE.PlaneBufferGeometry(1, 50);
                    let material_s = new THREE.MeshBasicMaterial();
                    legend_scale_ratio = myscale(0,[1,legend_scale_length+1],[0,1],j+1);
                    material_s.transparent = true;
                    material_s.opacity = legend_scale_ratio;
                    let legend_scale_point = new THREE.Mesh(geometry_s,material_s);
                    legend_scale_point.position.set(location_x, location_y, tile_point_z);

                    legend_scale_point.material.color.setRGB(colors_class[i][0],colors_class[i][1],colors_class[i][2]);
                    // legend_scale_point.material.color.setRGB(colors_class[i][0] * legend_scale_ratio,
                    //     colors_class[i][1] * legend_scale_ratio,
                    //     colors_class[i][2] * legend_scale_ratio);
                    // legend_scale_point.material.color.setRGB(colors_class[i][0] * (legend_scale_ratio + j/legend_scale_length),
                    //     colors_class[i][1] * (legend_scale_ratio + j/legend_scale_length),
                    //     colors_class[i][2] * (legend_scale_ratio + j/legend_scale_length));
                    //legends_s.add(legend_scale_point);
                    //scene_legend.add( legend_scale_point );
                    legends.push(legend_scale_point);
                }

            }
            let geometry_s_a = new THREE.Geometry();
            geometry_s_a.vertices.push( new THREE.Vector3( -200, -50, 0 ) );
            geometry_s_a.vertices.push( new THREE.Vector3( 600, -50, 0 ) );

            var legend_s_axis = new THREE.Line( geometry_s_a, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            //scene_legend.add( legend_s_axis );
            legends.push(legend_s_axis);

            let geometry_subs_a = new THREE.Geometry();
            geometry_subs_a.vertices.push( new THREE.Vector3( -200, -50, 0 ) );
            geometry_subs_a.vertices.push( new THREE.Vector3( -200, -20, 0 ) );

            var sublegend_x0 = new THREE.Line( geometry_subs_a, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            //scene_legend.add( sublegend_x0 );
            legends.push(sublegend_x0);


            var sublegend_x4 = new THREE.Line( geometry_subs_a, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            sublegend_x4.position.x = 800;//以父节点为原点平移
            //scene_legend.add( sublegend_x4 );
            legends.push(sublegend_x4);

            // if(legend_show_if === 1){
            //     scene_legend.remove(sublegend_x1);
            //     scene_legend.remove(sublegend_x2);
            //     scene_legend.remove(sublegend_x3);
            // }

            sublegend_x1 = new THREE.Line( geometry_subs_a, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            sublegend_x2 = new THREE.Line( geometry_subs_a, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            sublegend_x3 = new THREE.Line( geometry_subs_a, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.9 } ) );
            legend_show_if = 1;
            switch (scale_type) {
                case 0:
                case 4:
                    sublegend_x1.position.x = 200;
                    sublegend_x2.position.x = 400;
                    sublegend_x3.position.x = 600;
                    break;
                case 1:
                    sublegend_x1.position.x = myscale(1,[1,800],[1,800],200);
                    sublegend_x2.position.x = myscale(1,[1,800],[1,800],400);
                    sublegend_x3.position.x = myscale(1,[1,800],[1,800],600);
                    break;
                case 2:
                    sublegend_x1.position.x = myscale(2,[1,800],[1,800],200);
                    sublegend_x2.position.x = myscale(2,[1,800],[1,800],400);
                    sublegend_x3.position.x = myscale(2,[1,800],[1,800],600);
                    break;
                case 3:
                    sublegend_x1.position.x = myscale(3,[1,800],[1,800],200);
                    sublegend_x2.position.x = myscale(3,[1,800],[1,800],400);
                    sublegend_x3.position.x = myscale(3,[1,800],[1,800],600);
                    break;

            }

            // scene_legend.add( sublegend_x1 );
            // scene_legend.add( sublegend_x2 );
            // scene_legend.add( sublegend_x3 );
            legends.push(sublegend_x1);
            legends.push(sublegend_x2);
            legends.push(sublegend_x3);





            //scene_legend.add( legends_s );

            //----混合的图例----
            let geometry_b = new THREE.BufferGeometry();
            let positions_b = [];
            let colors_b = [];
            let legend_blend_length = 400;
            let color_alpha = 0;
            switch (mood) {
                case 1://max
                    for(let i = 0;i<legend_blend_length;i++){
                        for(let j = 0;j<legend_blend_length;j++){
                            location_x = -650 + i;
                            location_y = -200 - j;

                            if(i>=j){
                                // color.setRGB(colors_class[0][0] * (i/legend_blend_length) ,
                                //     colors_class[0][1] * (i/legend_blend_length) ,
                                //     colors_class[0][2] * (i/legend_blend_length) );
                                color_alpha = myscale(0,[0,1],[1,50],i/legend_blend_length);
                                for(let t = 0;t<color_alpha;t++){
                                    positions_b.push( location_x, location_y, tile_point_z );
                                    colors_b.push( colors_class[0][0],colors_class[0][1],colors_class[0][2] );
                                }
                            }else{
                                // color.setRGB(colors_class[2][0] * (j/legend_blend_length),
                                //     colors_class[2][1] * (j/legend_blend_length),
                                //     colors_class[2][2] * (j/legend_blend_length));
                                // colors_b.push( color.r, color.g, color.b );
                                color_alpha = myscale(0,[0,1],[1,50],j/legend_blend_length);
                                for(let t = 0;t<color_alpha;t++){
                                    positions_b.push( location_x, location_y, tile_point_z );
                                    colors_b.push( colors_class[2][0],colors_class[2][1],colors_class[2][2] );
                                }
                            }

                        }
                    }
                    break;
                case 0:
                case 2://mean
                    for(let i = 0;i<legend_blend_length;i++){
                        for(let j = 0;j<legend_blend_length;j++){
                            location_x = -650 + i;
                            location_y = -200 - j;
                            // positions_b.push( location_x, location_y, tile_point_z );
                            // color.setRGB(colors_class[0][0] * (i/legend_blend_length) + colors_class[2][0] * (j/legend_blend_length),
                            //     colors_class[0][1] * (i/legend_blend_length) + colors_class[2][1] * (j/legend_blend_length),
                            //     colors_class[0][2] * (i/legend_blend_length) + colors_class[2][2] * (j/legend_blend_length));
                            // colors_b.push( color.r, color.g, color.b );
                            color_alpha = myscale(0,[0,1],[1,50],i/legend_blend_length);
                            for(let t = 0;t<color_alpha;t++){
                                positions_b.push( location_x, location_y, tile_point_z );
                                colors_b.push( colors_class[0][0],colors_class[0][1],colors_class[0][2] );
                            }
                            color_alpha = myscale(0,[0,1],[1,50],j/legend_blend_length);
                            for(let t = 0;t<color_alpha;t++){
                                positions_b.push( location_x, location_y, tile_point_z );
                                colors_b.push( colors_class[2][0],colors_class[2][1],colors_class[2][2] );
                            }
                        }
                    }
                    break;

                default://none
                    for(let i = 0;i<legend_blend_length;i++){
                        for(let j = 0;j<legend_blend_length;j++){
                            location_x = -650 + i;
                            location_y = -200 - j;
                            positions_b.push( location_x, location_y, tile_point_z );
                            color.setRGB(0,0,0);
                            colors_b.push( color.r, color.g, color.b );
                        }
                    }

            }




            geometry_b.setAttribute( 'position', new THREE.Float32BufferAttribute( positions_b, 3 ) );
            geometry_b.setAttribute( 'color', new THREE.Float32BufferAttribute( colors_b, 3 ) );
            geometry_b.computeBoundingSphere();
            let material_b = new THREE.PointsMaterial( { size: 4, vertexColors: true } );
            material_b.transparent = true;
             material_b.opacity = 0.02;
            legends_b = new THREE.Points( geometry_b, material_b );

            //scene_legend.add( legends_b );
            legends.push(legends_b);
            add_allitem(scene_legend,legends);



        }
        function show_axis() {
            let subaxis_num = 9;
            let axis_distance = 64;

            let geometry_axis = new THREE.Geometry();
            geometry_axis.vertices.push( new THREE.Vector3( -board_length/2, -board_length/2 - axis_distance, 0 ) );
            geometry_axis.vertices.push( new THREE.Vector3( board_length/2, -board_length/2 - axis_distance, 0 ) );

            var axis_x = new THREE.Line( geometry_axis, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.5 } ) );
            scene.add( axis_x );

            var axis_y = new THREE.Line( geometry_axis, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.5 } ) );
            axis_y.rotation.z = 270 * Math.PI / 180; //逆时针旋转
            scene.add( axis_y );

            let geometry_subaxis_x = new THREE.Geometry();
            geometry_subaxis_x.vertices.push( new THREE.Vector3( 0, -board_length/2 - axis_distance, 0 ) );
            geometry_subaxis_x.vertices.push( new THREE.Vector3( 0, -board_length/2 - axis_distance - 20, 0 ) );

            let geometry_subaxis_y = new THREE.Geometry();
            geometry_subaxis_y.vertices.push( new THREE.Vector3( -board_length/2 - axis_distance, 0, 0 ) );
            geometry_subaxis_y.vertices.push( new THREE.Vector3( -board_length/2 - axis_distance -20, 0, 0 ) );

            for(let i = 0; i < subaxis_num; i++){
                var subaxis_x = new THREE.Line( geometry_subaxis_x, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.7 } ) );
                subaxis_x.position.x = ( i * side_length*2 ) - (tile_num/2) * side_length;
                scene.add( subaxis_x );

                var subaxis_y = new THREE.Line( geometry_subaxis_y, new THREE.LineBasicMaterial( { color: 0x050505, opacity: 0.7 } ) );
                subaxis_y.position.y = ( i * side_length*2 ) - (tile_num/2) * side_length;
                scene.add( subaxis_y );
            }

            //显示文字




        }


        function change_json() {
            if(dataset_source <3){
                json_url1 = json_url1_set[dataset_source];
                json_url2 = json_url2_set[dataset_source];
                json_url3 = json_url3_set[dataset_source];
                json_url4 = json_url4_set[dataset_source];
            }
            json_colors_class_0 = '[' + colors_class_0.toString() + ']';
            json_colors_class_1 = '[' + colors_class_1.toString() + ']';
            json_colors_class_2 = '[' + colors_class_2.toString() + ']';
            json_colors_class_3 = '[' + colors_class_3.toString() + ']';

            json_rebin = json_rebin_type_set[rebin_type];
            json_rebin_size = json_rebin_size_set[rebin_square_size_type];
            json_scale = json_scale_set[scale_type];
            json_legend = json_legend_set[legend_if];
            json_axis = json_axis_set[axis_if];
            // if(rebin_type === 0){
            //     json_rebin = 'None';
            // }else{
            //     json_rebin = 'Square';
            // }
            // switch (rebin_square_size_type){
            //     case 0:
            //         json_rebin_size = 'Small';
            //         break;
            //     case 1:
            //         json_rebin_size = 'Default';
            //         break;
            //     case 2:
            //         json_rebin_size = 'Large';
            //         break;
            //     case 3:
            //         json_rebin_size = 'Auto';
            //         break;
            // }
            // switch (scale_type){
            //     case 0:
            //         json_scale = 'Linear';
            //         break;
            //     case 1:
            //         json_scale = 'Log';
            //         break;
            //     case 2:
            //         json_scale = 'Square Root';
            //         break;
            //     case 3:
            //         json_scale = 'Cubic Root';
            //         break;
            //     case 4:
            //         json_scale = 'Equi-depth';
            //         break;
            // }

            // if(legend_if === 0){
            //     json_legend = 'True';
            // }else{
            //     json_legend = 'False';
            // }
            //
            // if(axis_if === 0){
            //     json_axis = 'True';
            // }else{
            //     json_axis = 'False';
            // }

            document.getElementById("js-url1").innerHTML=json_url1;
            document.getElementById("js-color1").innerHTML=json_colors_class_0;
            document.getElementById("js-url2").innerHTML=json_url2;
            document.getElementById("js-color2").innerHTML=json_colors_class_1;
            document.getElementById("js-url3").innerHTML=json_url3;
            document.getElementById("js-color3").innerHTML=json_colors_class_2;
            document.getElementById("js-url4").innerHTML=json_url4;
            document.getElementById("js-color4").innerHTML=json_colors_class_3;
            document.getElementById("js-rebin").innerHTML=json_rebin;
            document.getElementById("js-rebin_size").innerHTML=json_rebin_size;
            document.getElementById("js-compose").innerHTML=json_compose;
            document.getElementById("js-scale").innerHTML=json_scale;
            document.getElementById("js-smooth").innerHTML=json_smooth;
            document.getElementById("js-smooth_radius").innerHTML=json_smooth_core;
            document.getElementById("js-legend").innerHTML=json_legend;
            document.getElementById("js-axis").innerHTML=json_axis;
        }


        function setsquaresize() {
            switch (rebin_square_size_type) {
                case 1:
                case 3:
                    side_length = 64;
                    tile_num = board_length/side_length;//16
                    point_per_tile = pixel_num/tile_num;//4
                    break;
                case 0:
                    side_length = 32;
                    tile_num = board_length/side_length;//32
                    point_per_tile = pixel_num/tile_num;//8
                    break;
                case 2:
                    side_length = 128;
                    tile_num = board_length/side_length;//8
                    point_per_tile = pixel_num/tile_num;//16
                    break;

            }
            //设置data_vector
            for ( let i = 0; i < tile_num; i++) { //一维长度为2
                data_vector[i] = new Array(); //再声明二维
                for ( let j = 0; j < tile_num; j++) { //二维长度为3
                    data_vector[i][j] = new Array(); //再声明二维
                    for ( let z = 0; z < class_num; z++) { //二维长度为3
                        data_vector[i][j][z] = 0; // 赋值，每个数组元素的值为i+j
                    }
                }
            }
        }

        function data_smooth(){
            let mask1 = 0;
            let mask2 = 0;
            let mask1_gy = 0;
            let mask2_gy = 0;
            let mask0_gy = 1;
            let mask_all = 0;
            if(smooth_core === 1){
                mask1_gy = 0.12;
                mask2_gy = 0.08;
                console.log('maskgy: '+ mask1_gy + ' ' + mask2_gy);
            }else{
                mask1 = Math.pow(Math.E,-1 / (2 * smooth_core*smooth_core) );
                mask2 = Math.pow(Math.E,-2 / (2 * smooth_core*smooth_core) );
                mask1 = Number(mask1.toFixed(4)) ;
                mask2 = Number(mask2.toFixed(4));
                console.log('mask: '+ mask1 + ' ' + mask2);

                //归一化
                mask_all = 4 * (mask1+mask2) + 1;
                mask_all = Number(mask_all.toFixed(4));
                console.log('mask_all: '+ mask_all);
                mask0_gy = 1 / mask_all;
                mask1_gy = mask1 / mask_all;
                mask2_gy = mask2 / mask_all;

                mask1_gy = Number(mask1_gy.toFixed(2));
                mask2_gy = Number(mask2_gy.toFixed(2));
                mask0_gy = Number(mask0_gy.toFixed(2));
                console.log('maskgy: '+ mask0_gy + ' '+ mask1_gy + ' ' + mask2_gy);

            }

            for(let c=0;c<class_num;c++){

                for ( let i = 1; i < pixel_num - 1; i++) {
                    for ( let j = 1; j < pixel_num - 1; j++) {
                       data_buffer_smooth[i][j][c] = data_buffer[i][j][c] * mask0_gy +
                                mask1_gy * (data_buffer[i-1][j][c] + data_buffer[i+1][j][c] + data_buffer[i][j-1][c] + data_buffer[i][j+1][c]) +
                                mask2_gy * (data_buffer[i-1][j-1][c] + data_buffer[i+1][j-1][c] + data_buffer[i-1][j+1][c] + data_buffer[i+1][j+1][c]);
                    }
                }

                for ( let i = 1; i < pixel_num - 1; i++) {
                    data_buffer_smooth[i][0][c] = data_buffer[i][0][c] * mask0_gy +
                        mask1_gy * (data_buffer[i-1][0][c] + data_buffer[i+1][0][c] + data_buffer[i][1][c]) +
                        mask2_gy * (data_buffer[i-1][1][c] + data_buffer[i+1][1][c]);
                    data_buffer_smooth[i][pixel_num][c] = data_buffer[i][pixel_num][c] * mask0_gy +
                        mask1_gy * (data_buffer[i-1][pixel_num][c] + data_buffer[i+1][pixel_num][c] + data_buffer[i][pixel_num-1][c]) +
                        mask2_gy * (data_buffer[i-1][pixel_num-1][c] + data_buffer[i+1][pixel_num-1][c]);
                }
                for ( let j = 1; j < pixel_num - 1; j++) {
                    data_buffer_smooth[0][j][c] = data_buffer[0][j][c] * mask0_gy +
                        mask1_gy * (data_buffer[0][j-1][c] + data_buffer[0][j+1][c] + data_buffer[1][j][c]) +
                        mask2_gy * (data_buffer[1][j-1][c] + data_buffer[1][j+1][c]);
                    data_buffer_smooth[pixel_num][j][c] = data_buffer[pixel_num][j][c] * mask0_gy +
                        mask1_gy * (data_buffer[pixel_num-1][j][c] + data_buffer[pixel_num][j-1][c] + data_buffer[pixel_num][j+1][c]) +
                        mask2_gy * (data_buffer[pixel_num-1][j-1][c] + data_buffer[pixel_num-1][j+1][c]);
                }

                data_buffer_smooth[0][0][c] = data_buffer[0][0][c] * mask0_gy +
                    mask1_gy * (data_buffer[0][1][c] + data_buffer[1][0][c]) +
                    mask2_gy * data_buffer[1][1][c];
                data_buffer_smooth[0][pixel_num][c] = data_buffer[0][pixel_num][c] * mask0_gy +
                    mask1_gy * (data_buffer[0][pixel_num-1][c] + data_buffer[1][pixel_num][c]) +
                    mask2_gy * data_buffer[1][pixel_num-1][c];
                data_buffer_smooth[pixel_num][0][c] = data_buffer[pixel_num][0][c] * mask0_gy +
                    mask1_gy * (data_buffer[pixel_num][1][c] + data_buffer[pixel_num-1][0][c]) +
                    mask2_gy * data_buffer[pixel_num-1][1][c];
                data_buffer_smooth[pixel_num][pixel_num][c] = data_buffer[pixel_num][pixel_num][c] * mask0_gy +
                    mask1_gy * (data_buffer[pixel_num][pixel_num-1][c] + data_buffer[pixel_num-1][pixel_num][c]) +
                    mask2_gy * data_buffer[pixel_num-1][pixel_num-1][c];

            }
            for ( let i = 0; i < pixel_num; i++) {
                for ( let j = 0; j < pixel_num; j++) {
                    for ( let z = 0; z < class_num; z++) { //二维长度为3
                        data_buffer[i][j][z] = data_buffer_smooth[i][j][z]; // 赋值，每个数组元素的值为i+j
                    }
                }
            }

        }

        function generate_pre() {

            setsquaresize();
            readdata();
            if(smooth_if === 1){
                data_smooth();
            }
            setTimeout("setClassBuffer()","100");
            setTimeout("initObject()","100");  //2000毫秒后执行test()函数，只执行一次。
            setTimeout("calculate_max()","100");
            setTimeout("generate()","100");

        }
        function generate(){
            // readdata();
            // setTimeout("initObject()","100");  //2000毫秒后执行test()函数，只执行一次。
            // //initObject();
            // setTimeout("calculate_max()","100");
            delete_item(points);
            remove_allitem(scene,points);
            //scene.remove(points);
            //initObject();
            switch (mood) {
                case 0:
                    json_compose = 'None';
                    break;
                case 1:
                    json_compose = 'Max';
                    mood_max();
                    break;
                case 2:
                    json_compose = 'Mean';
                    mood_mean();
                    break;
                case 3:
                    json_compose = 'Blend';
                    mood_blend();
                    break;
                case 4:
                    json_compose = 'Invmin';
                    mood_invmin();
                    break;
                case 5:
                    json_compose = 'Weaving';
                    mood_weaving();
                    break;
                case 6:
                    json_compose = 'Propline';
                    mood_propline();
                    break;
                case 7:
                    json_compose = 'Division';
                    mood_division();
                    break;
                case 8:
                    json_compose = 'Separate';
                    mood_separate();
                    break;
                case 9:
                    json_compose = 'Time';
                    mood_time();
                    break;
                case 10:
                    json_compose = 'Hatching';
                    mood_hatching();
                    break;
                case 11:
                    json_compose = 'Glyph';
                    mood_glyph();
                    break;

            }
            change_json();

            show_legend();//图例一直显示，选择false是在打印的时候不显示图例

            if(axis_if === 0){
                show_axis();
            }

            console.log('!!: '+this.renderer.info);
            test0();
        }

        function test0() {
            console.log('test: ' + class_buffer0.getNum());
            console.log('test: ' + class_buffer0.data_buffer);
            console.log('test: ' + class_buffer0.getDataBuffer());
            console.log('test: ' + class_buffer0.getColor());
            console.log('test: ' + class_buffer0.getAngle());
            console.log('test: ' + class_buffer0.getScale());
        }


        //定义键盘按键事件
        function setKeyEvents(){
            window.addEventListener('keydown',function(e){
                console.log(e);
                if (e.key === 'ArrowUp'){
                    console.log("up");
                    camera.position.y += 50;
                }
                if (e.key === 'ArrowDown'){
                    console.log("down");
                    camera.position.y -= 50;
                }
                if (e.key === 'ArrowLeft'){
                    console.log("left");
                    camera.position.x -= 50;
                }
                if (e.key === 'ArrowRight'){
                    console.log("right");
                    camera.position.x += 50;
                }
                if (e.key === '1'){
                    console.log("1-max");
                    mood_max();
                }
                if (e.key === '2'){
                    console.log("2-mean");
                    mood_mean();
                }
                if (e.key === '3'){
                    console.log("3-blend");
                    mood_blend();
                }
                if (e.key === '4'){
                    console.log("4-invmin");
                    mood_invmin();
                }
                if (e.key === '5'){
                    console.log("5-weaving");
                    mood_weaving();
                }
                if (e.key === '6'){
                    console.log("6-propline");
                    mood_propline();
                }
                if (e.key === '7'){
                    console.log("7-division");
                    mood_division();
                }
                if (e.key === '8'){
                    console.log("8-separate");
                    mood_separate();
                }
                if (e.key === '9'){
                    console.log("9-time");
                    mood_time();
                }
                if (e.key === '10'){
                    console.log("10-hatchine");
                    mood_hatching();
                }
                if (e.key === '11'){
                    console.log("11-glyph");
                    mood_glyph();
                }
            });
        }
        function data2buffer(data,c) {
            let l = data.length;

            for ( let i = 0; i < pixel_num; i++) {
                for ( let j = 0; j < pixel_num; j++) {
                    data_buffer[i][j][c] = 0;
                }
            }

            for(let i in data)
            {
                for(let j in data[i])
                {
                    let x = Math.floor((i*pixel_num)/l);
                    let y = Math.floor((j*pixel_num)/l);
                    data_buffer[x][y][c] += data[i][j];
                    // if(l<pixel_num*2){
                    //     data_buffer[x][y][c] = data[i][j];
                    // }else{
                    //     data_buffer[x][y][c] += data[i][j];
                    // }

                }
            }


        }
        function readJSON(file, callback) {
            console.log('readjson ');
            let ajax = new XMLHttpRequest();
            ajax.overrideMimeType("application/json");
            ajax.open("GET", file, true);
            ajax.onreadystatechange = function () {
                if (ajax.readyState === 4 && ajax.status == "200") {
                    callback(ajax.responseText);
                }
            };
            ajax.send(null);
            console.log('readjson end ');
        }

        function readdata() {
            console.log('readdata: ');
            //  url
            readJSON(json_url1_set[dataset_source], function(res){
                //console.log('read ');
                let data = JSON.parse(res);
                console.log(data);
                data2buffer(data,0)
                // for(let i in data)
                // {
                //     for(let j in data[i])
                //     {
                //         data_buffer[i][j][0] = data[i][j];
                //         //console.log(data[i][j]);
                //     }
                // }
            });
            readJSON(json_url2_set[dataset_source], function(res){
                //console.log('read ');
                let data = JSON.parse(res);
                console.log(data);
                data2buffer(data,1);
                // for(let i in data)
                // {
                //     for(let j in data[i])
                //     {
                //         data_buffer[i][j][1] = data[i][j];
                //         //console.log(data[i][j]);
                //     }
                // }
            });
            readJSON(json_url3_set[dataset_source], function(res){
                //console.log('read ');
                let data = JSON.parse(res);
                console.log(data);
                data2buffer(data,2);
                // for(let i in data)
                // {
                //     for(let j in data[i])
                //     {
                //         data_buffer[i][j][2] = data[i][j];
                //         //console.log(data[i][j]);
                //     }
                // }
            });
            readJSON(json_url4_set[dataset_source], function(res){
                //console.log('read ');
                let data = JSON.parse(res);
                console.log(data);
                data2buffer(data,3);
                // for(let i in data)
                // {
                //     for(let j in data[i])
                //     {
                //         data_buffer[i][j][3] = data[i][j];
                //         //console.log(data[i][j]);
                //     }
                // }
            });

            // if(smooth_if === 1){
            //     data_smooth();
            // }

        }

        function setClassBuffer() {
            //----------------设置classbuffer----------------------

            let color = new THREE.Color();
            //let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            // for(let i = 0;i<class_num;i++){
            // }

            let db = new Array(); //先声明一维
            for ( let i = 0; i < pixel_num; i++) {
                db[i] = new Array(); //再声明二维
                for ( let j = 0; j < pixel_num; j++) {
                    db[i][j] = 0;
                }
            }

            color.setRGB(colors_class[0][0],colors_class[0][1],colors_class[0][2]);
            for(let i in data_buffer)
            {
                for(let j in data_buffer[i])
                {
                    db[i][j] = data_buffer[i][j][0];
                }
            }
            // for ( let i = 0; i < pixel_num; i++) {
            //     for ( let j = 0; j < pixel_num; j++) {
            //         db[i][j] = data_buffer[i][j][0];
            //     }
            // }
            console.log('db: '+ db);
            class_buffer0 = new class_buffer(0,db,color,angles[0],scale_type);
            console.log('set cb: '+ class_buffer0.data_buffer);
            console.log('databuffer: '+ data_buffer);

            color.setRGB(colors_class[1][0],colors_class[1][1],colors_class[1][2]);
            for(let i in data_buffer)
            {
                for(let j in data_buffer[i])
                {
                    db[i][j] = data_buffer[i][j][1];
                }
            }
            class_buffer1 = new class_buffer(1,db,color,angles[1],scale_type);

            color.setRGB(colors_class[2][0],colors_class[2][1],colors_class[2][2]);
            for(let i in data_buffer)
            {
                for(let j in data_buffer[i])
                {
                    db[i][j] = data_buffer[i][j][2];
                }
            }
            class_buffer2 = new class_buffer(2,db,color,angles[2],scale_type);

            color.setRGB(colors_class[3][0],colors_class[3][1],colors_class[3][2]);
            for(let i in data_buffer)
            {
                for(let j in data_buffer[i])
                {
                    db[i][j] = data_buffer[i][j][3];
                }
            }
            class_buffer3 = new class_buffer(3,db,color,angles[3],scale_type);

            //----------------------------------------------------------------------

        }


        var cube;
        function initObject() {


            // var geometry = new THREE.Geometry();//后期数据量大使用buffergeometry
            // var material = new THREE.PointsMaterial({color:0xFFFFFF});
            //
            // var geometryl = new THREE.Geometry();//后期数据量大使用buffergeometry
            // var materiall = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors} );
            // var color1 = new THREE.Color( 0x444444 );
            // var color2 = new THREE.Color( 0xFF0000 );
            //
            // // 线的材质可以由2点的颜色决定
            // var p1 = new THREE.Vector3( -100, 0, 0 );
            // var p2 = new THREE.Vector3(  100, 0, 0 );
            // var p3 = new THREE.Vector3( -100, 5, 0 );
            // var p4 = new THREE.Vector3(  100, 5, 0 );
            //
            // geometryl.vertices.push(p1,p2);
            // geometryl.colors.push( color1, color2);
            //
            //  geometry.vertices.push(p1,p2,p3,p4);
            // var points = new THREE.Points(geometry,material);
            // var line = new THREE.Line( geometryl, materiall,THREE.LineSegments);
            // scene.add(line);
            // scene.add(points);

            //-------------------------------------------------------------------------
            let geometry = new THREE.BufferGeometry();
            let positions = [];
            let colors = [];
            let color = new THREE.Color();
            let color_r = new THREE.Color();
            let color_g = new THREE.Color();
            let color_b = new THREE.Color();
            let color_o = new THREE.Color();
            color_r.setRGB(1,0,0);
            color_g.setRGB(0,1,0);
            //color_g.setHex(0x005500);
            color_b.setRGB(0,0,1);
            color_o.setRGB(1,1,0);
            let n = board_length;
            let n2 = n / 2; // particles spread in the cube
            let particles = 200000;

            // for ( var i = 0; i < particles; i ++ ) {
            //     // positions
            //     var x = Math.random() * n - n2;
            //     var y = Math.random() * n - n2;
            //     //var z = Math.random() * n - n2;
            //     var z = 0;
            //     positions.push( x, y, z );
            //     // colors
            //     var vx = ( x / n ) + 0.5;
            //     var vy = ( y / n ) + 0.5;
            //     var vz = ( z / n ) + 0.5;
            //     color.setRGB( vx, vy, vz );
            //     colors.push( color.r, color.g, color.b );
            // }

            //清零
            for(let i = 0;i<tile_num;i++){
                for(let j = 0;j<tile_num;j++){
                    for(let c = 0;c<class_num;c++){
                        data_vector[i][j][c] = 0;
                    }
                }
            }

            let point_ratio = 0.7;
            let point_shift = 1.5;


            var mult=4;
            //var dev1 = 25.6;
            for(let m = 0; m<pixel_num;m++){
                for(let n = 0; n<pixel_num; n++){
                    for(let k=0;k<data_buffer[m][n][0];k++){
                        // positions.push( (m-128)*mult, (n-128)*mult, 0 );
                        // colors.push( color_r.r, color_r.g, color_r.b );
                        let location_x = Math.floor(m/point_per_tile);
                        let location_y = Math.floor(n/point_per_tile);
                        data_vector[location_x][location_y][0]++;
                    }

                }
            }
            for(let m = 0; m<pixel_num;m++){
                for(let n = 0; n<pixel_num; n++){
                    for(let k=0;k<data_buffer[m][n][1];k++){
                        // positions.push( (m-128)*mult, (n-128)*mult, 0 );
                        // colors.push( color_g.r, color_g.g, color_g.b );
                        let location_x = Math.floor(m/point_per_tile);
                        let location_y = Math.floor(n/point_per_tile);
                        data_vector[location_x][location_y][1]++;
                    }

                }
            }
            for(let m = 0; m<pixel_num;m++){
                for(let n = 0; n<pixel_num; n++){
                    for(let k=0;k<data_buffer[m][n][2];k++){
                        // positions.push( (m-128)*mult, (n-128)*mult, 0 );
                        // colors.push( color_b.r, color_b.g, color_b.b );
                        let location_x = Math.floor(m/point_per_tile);
                        let location_y = Math.floor(n/point_per_tile);
                        data_vector[location_x][location_y][2]++;
                    }

                }
            }
            for(let m = 0; m<pixel_num;m++){
                for(let n = 0; n<pixel_num; n++){
                    for(let k=0;k<data_buffer[m][n][3];k++){
                        // positions.push( (m-128)*mult, (n-128)*mult, 0 );
                        // colors.push( color_o.r, color_o.g, color_o.b );
                        let location_x = Math.floor(m/point_per_tile);
                        let location_y = Math.floor(n/point_per_tile);
                        data_vector[location_x][location_y][3]++;
                    }

                }
            }
            //计算point_max_pixel
            point_max_pixel = 0;
            for(let m = 0; m<pixel_num;m++){
                for(let n = 0; n<pixel_num; n++){
                    for(let a = 0;a<class_num;a++){
                        if(data_buffer[m][n][a] > point_max_pixel){
                            point_max_pixel = data_buffer[m][n][a];
                        }
                    }

                }
            }

            // let classmax = 0;
            // let colors_class = [ [ 1,0,0 ], [ 0,1,0 ], [ 0,0,1 ], [ 1,1,0 ] ];
            // for(let m = 0; m<pixel_num;m++){
            //     for(let n = 0; n<pixel_num; n++){
            //
            //         if(data_buffer[m][n][0] > data_buffer[m][n][1]){
            //             classmax = 0;
            //         }else{
            //             classmax = 1;
            //         }
            //         if(data_buffer[m][n][2] > data_buffer[m][n][classmax]){
            //             classmax = 2;
            //         }
            //         if(data_buffer[m][n][3] > data_buffer[m][n][classmax]){
            //             classmax = 3;
            //         }
            //
            //         positions.push( (m-128)*mult, (n-128)*mult, 0 );
            //         color.setRGB(colors_class[classmax][0] * data_buffer[m][n][classmax]/point_max_pixel ,
            //             colors_class[classmax][1] * data_buffer[m][n][classmax]/point_max_pixel ,
            //             colors_class[classmax][2] * data_buffer[m][n][classmax]/point_max_pixel);
            //         colors.push( color.r, color.g, color.b );
            //     }
            // }
            //
            //
            // geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
            // geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );
            // geometry.computeBoundingSphere();
            // let material = new THREE.PointsMaterial( { size: 5, vertexColors: true } );
            // material.transparent = true;
            // material.opacity = 0.6;
            //
            // points = new THREE.Points( geometry, material );
            // scene.add( points );//原始点阵！！！！！！！！！！！！！！！！！！！！！！！！here
            //------------------------------------------------------------------------------------
            // var lines = new THREE.Line();

            // scene.remove(lines);
            delete_allitem(lines);
            remove_allitem(scene,lines);

            let geometry_mesh = new THREE.Geometry();
            geometry_mesh.vertices.push( new THREE.Vector3( -board_length/2, 0, 0 ) );
            geometry_mesh.vertices.push( new THREE.Vector3( board_length/2, 0, 0 ) );
            console.log('画线 '+tile_num);

            for ( let i = 0; i <= tile_num; i ++ ) {

                var line = new THREE.Line( geometry_mesh, new THREE.LineBasicMaterial( { color: 0xFFFFFF, opacity: 0.5 } ) );
                line.position.y = ( i * side_length ) - (tile_num/2) * side_length;
                lines.push(line);
                //scene.add( line );

                var line = new THREE.Line( geometry_mesh, new THREE.LineBasicMaterial( { color: 0xFFFFFF, opacity: 0.5 } ) );
                line.position.x = ( i * side_length ) - (tile_num/2) * side_length;
                line.rotation.z = 90 * Math.PI / 180; //逆时针旋转
                lines.push(line);
                //scene.add( line );

            }
           // scene.add( lines );
            add_allitem(scene,lines);
        }

        function SetParameter() {
            for(let i = 0;i<3;i++){
                if(json_url1 === json_url1_set[i] ){
                    dataset_source = i;           console.log('dataset_source = '+ dataset_source);
                }
            }

            colors_class[0] = colors_class_0;
            colors_class[1] = colors_class_1;
            colors_class[2] = colors_class_2;
            colors_class[3] = colors_class_3;

            for(let i = 0;i<2;i++){
                if(json_rebin === json_rebin_type_set[i] ){
                    rebin_type = i;           console.log('rebin = '+ rebin_type);
                }
            }
            for(let i = 0;i<4;i++){
                if(json_rebin_size === json_rebin_size_set[i] ){
                    rebin_square_size_type = i;     console.log('size = '+ rebin_square_size_type);
                }
            }
            for(let i = 0;i<12;i++){
                if(json_compose === json_compose_set[i] ){
                    mood = i;           console.log('mood = '+ mood);
                }
            }
            for(let i = 0;i<5;i++){
                if(json_scale === json_scale_set[i] ){
                    scale_type = i;     console.log('scale = '+ scale_type);
                }
            }

            for(let i = 0;i<1;i++){
                if(json_smooth === json_smooth_set[i] ){
                    smooth_if = i;      console.log('legend = '+ legend_if);
                }
            }

            smooth_core = Number(json_smooth_core);


            for(let i = 0;i<1;i++){
                if(json_legend === json_legend_set[i] ){
                    legend_if = i;      console.log('legend = '+ legend_if);
                }
            }
            for(let i = 0;i<1;i++){
                if(json_axis === json_axis_set[i] ){
                    axis_if = i;        console.log('axis = '+ axis_if);
                }
            }

            
        }

        function string2number(string) {
            let l = string.length;
            string = string.slice(1,l-1);
            let string2 = string.split(',');
            string2.forEach((item,index) =>{
                string2[index] = parseFloat(string2[index])
            });
            return string2;
        }
        
        function json_upload() {
            var selectedFile = document.getElementById("button_input").files[0];//获取读取的File对象
            var name = selectedFile.name;//读取选中文件的文件名
            var size = selectedFile.size;//读取选中文件的大小
            console.log("文件名:"+name+"大小："+size);
            var reader = new FileReader();//这里是核心！！！读取操作就是由它完成的。
            reader.readAsText(selectedFile);//读取文件的内容

            reader.onload = function(){
                console.log("读取结果：", this.result);//当读取完成之后会回调这个函数，然后此时文件的内容存储到了result中。直接操作即可。

                console.log("读取结果转为JSON：");
                let json = JSON.parse(this.result);
                console.log('data1: '+json.data.url1);
                console.log('color1: '+json.data.color1);
                console.log('data2: '+json.data.url2);
                console.log('color2: '+json.data.color2);
                console.log('data3: '+json.data.url3);
                console.log('color3: '+json.data.color3);
                console.log('data4: '+json.data.url4);
                console.log('color4: '+json.data.color4);
                console.log('rebin: '+json.rebin.type);
                console.log('size: '+json.rebin.size);
                console.log('compose: ' + json.compose.mix);
                console.log('scale: ' + json.rescale.type);
                console.log('smooth: ' + json.smooth.type);
                console.log('radius: ' + json.smooth.radius);
                console.log('legend: ' + json.legend);
                console.log('axis: ' + json.axis);
                
                json_url1 = json.data.url1;
                colors_class_0 = string2number(json.data.color1);//定义在上面
                json_url2 = json.data.url2;
                colors_class_1 = string2number(json.data.color2);//定义在上面
                json_url3 = json.data.url3;
                colors_class_2 = string2number(json.data.color3);//定义在上面
                json_url4 = json.data.url4;
                colors_class_3 = string2number(json.data.color4);//定义在上面
                json_rebin = json.rebin.type;
                json_rebin_size = json.rebin.size;
                json_compose = json.compose.mix;
                json_scale = json.rescale.type;
                json_smooth = json.smooth.type;
                json_smooth_core = json.smooth.radius;
                json_legend = json.legend;
                json_axis = json.axis;
            };
            setTimeout("SetParameter()","1000");
            //SetParameter();
            setTimeout("generate_pre()","1000");
            //generate();

        }
        // function json_upload() {
        //     var inputElement = document.getElementById("button_upload");
        //     inputElement.addEventListener("change", handleFiles, false);
        // }

        function json_download(){
            let json_data = {
                "data": {
                "url1": " ",
                "color1": " ",
                "url2": " ",
                "color2": " ",
                "url3": " ",
                "color3": " ",
                "url4": " ",
                "color4": " "
            },
                "rebin":{
                "type": " ",
                "size": " "
            },
                "compose": {
                "mix": " "
            },
                "smooth": {
                "type": " ",
                "radius": " "
            },
                "rescale": {
                "type": " "
            },
                "legend":" ",
                "axis": " "
            };
            json_data.data.url1 = json_url1;
            json_data.data.color1 = json_colors_class_0;//'[' + colors_class_0.toString() + ']';
            json_data.data.url2 = json_url2;
            json_data.data.color2 = json_colors_class_1;//'[' + colors_class_1.toString() + ']';
            json_data.data.url3 = json_url3;
            json_data.data.color3 = json_colors_class_2;//'[' + colors_class_2.toString() + ']';
            json_data.data.url4 = json_url4;
            json_data.data.color4 = json_colors_class_3;//'[' + colors_class_3.toString() + ']';
            json_data.rebin.type = json_rebin_type_set[rebin_type];
            json_data.rebin.size = json_rebin_size_set[rebin_square_size_type];
            json_data.compose.mix = json_compose_set[mood];
            json_data.rescale.type = json_scale_set[scale_type];
            json_data.smooth.type = json_smooth_set[smooth_if];
            json_data.smooth.radius = smooth_core;
            json_data.legend = json_legend_set[legend_if];
            json_data.axis = json_axis_set[axis_if];
            var content = JSON.stringify(json_data);
            var blob = new Blob([content], {type: "text/plain;charset=utf-8"});
            saveAs(blob, "save.json");
        }
        // function json_download() {
        //     var button = document.getElementById("button_download");
        //     button.addEventListener("click", saveHandler, false);
        //
        // }

        function json_print() {
            //var image = new Image();
            renderer.render(scene, camera);//此处renderer为three.js里的渲染器，scene为场景 camera为相机
            renderer_legend.render(scene_legend, camera_legend);
            // let imgData = renderer.domElement.toDataURL("image/jpeg");//这里可以选择png格式jpeg格式
            // image.src = imgData;
            // document.body.appendChild(image);//这样就可以查看截出来的图片了
            console.log('test');
            // html2canvas(document.getElementById('json-zone'), {
            //     allowTaint: true,
            //     taintTest: false,
            //     onrendered: function(canvas) {
            //         document.body.appendChild(canvas);
            //         var dataUrl = canvas.toDataURL();
            //         var newImg = document.createElement("img");
            //         newImg.src =  dataUrl;
            //         document.body.appendChild(newImg);
            //     },
            //     width: 300,
            //     height: 300
            //     //allowTaint: true
            // });

            let print_width = 1000;
            if(legend_if === 0){
                print_width = 1400;
            }

            // 调用html2canvas插件
            html2canvas(document.body,{
                width: print_width,
                height: 820,
                x:250,
                y:80
            }).then(function (canvas) {//document.body
                // canvas宽度
                var canvasWidth = canvas.width;
                // canvas高度
                var canvasHeight = canvas.height;
                // 调用Canvas2Image插件
                var img = Canvas2Image.convertToImage(canvas, canvasWidth, canvasHeight);
                //图片类型.宽度.高度.文件名
                let type = document.getElementById('sel') ? document.getElementById('sel').getAttribute('value') : null
                let w = document.getElementById('imgW') ? document.getElementById('imgW').getAttribute('value') : null
                let h = document.getElementById('imgH') ? document.getElementById('imgH').getAttribute('value') : null
                let f = document.getElementById('imgFileName') ? document.getElementById('imgFileName').getAttribute('value') : null
                w = (w === '') ? canvasWidth : w; //判断输入宽高是否为空，为空时保持原来的值
                h = (h === '') ? canvasHeight : h;
                // 调用Canvas2Image插件
                Canvas2Image.saveAsImage(canvas, w, h, type, f);
            });

            html2canvas(document.body, {
                allowTaint: false,
                foreignObjectRendering: true,
                taintTest: false,
                useCORS: true,//火狐浏览器添加项
                onrendered: function (canvas) {
                    var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
                    var userAgent = navigator.userAgent;
                    //判断是否是IE11
                    if (-1 !== userAgent.indexOf("Trident")) {
                        var arr = image.split(',');
                        var mime = arr[0].match(/:(.*?);/)[1];
                        var bstr = atob(arr[1]);
                        var n = bstr.length;
                        var u8arr = new Uint8Array(n);
                        while (n--) {
                            u8arr[n] = bstr.charCodeAt(n);
                        }
                        window.navigator.msSaveBlob(new Blob([u8arr], { type: mime }), "download.png");
                    } else {
                        canvas.id = "mycanvas";
                        //生成base64图片数据
                        var dataUrl = canvas.toDataURL();
                        var newImg = document.createElement("img");
                        newImg.setAttribute('crossOrigin', 'anonymous');
                        newImg.src = dataUrl;
                        var b = document.createElement('a');
                        b.setAttribute("href", dataUrl);
                        b.setAttribute("download", "img.png");
                        document.body.appendChild(b);//火狐浏览器添加项
                        b.click();
                        b.remove()
                    }
                }
            });
        }


        function delete_item(name) {
            let item = name;
            if(item instanceof THREE.Points){
                item.geometry.dispose();
                item.material.dispose();
            }

        }
        function delete_allitem(name) {
            let item = name;
            for(let i = 0;i<item.length;i++){
                delete_item(item[i]);
            }
        }
        function remove_allitem(scene, name) {
            let item = name;
            let iscene = scene;
            for(let i = 0;i<item.length;i++){
                iscene.remove(item[i]);
                //item[i] = null;
                //item.length = item.length - 1;
            }
            name.splice(0,name.length);
        }
        function add_allitem(scene, name) {
            let item = name;
            let iscene = scene;
            for(let i = 0;i<item.length;i++){
                iscene.add(item[i]);
            }
        }


        function render()
        {
            renderer.clear();
            //clearScene();

            // var time = Date.now() * 0.001;
            // points.rotation.x = time * 0.25;
            // points.rotation.y = time * 0.5;

            renderer.render(scene, camera);


            renderer_legend.clear();
            renderer_legend.render(scene_legend, camera_legend);

            requestAnimationFrame(render);

        }

        function threeStart() {
            initThree();
            initCamera();
            initScene();
            initLight();

            // readdata();
            // setTimeout("initObject()","100");  //100毫秒后执行test()函数，只执行一次。
            // setTimeout("calculate_max()","100");

            //calculate_max();//计算point_max
            //mood_max();
            setEventsMouse();//鼠标事件的定义
            //setControl();//设置鼠标控制
            setKeyEvents();//定义键盘按键事件
            mousewheel();//鼠标滚轮
            render();

        }

    </script>
    <script src="../../Desktop/data/Graduation project  /pick/code/研究一下/image.js"></script>
</head>

<body onload="threeStart();" data-background-color="dark">
    <div class="main-header">
        <!-- Logo Header -->
        <div class="logo-header" data-background-color="dark2">

            <a href="Sample.html" class="logo">
                <img src="assets/img/school3.png" alt="navbar brand" class="navbar-brand">
            </a>
            <button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon">
                                <i class="icon-menu"></i>
                            </span>
            </button>
            <button class="topbar-toggler more"><i class="icon-options-vertical"></i></button>
            <div class="nav-toggle">
                <button class="btn btn-toggle toggle-sidebar">
                    <i class="icon-menu"></i>
                </button>
            </div>
        </div>
        <!-- End Logo Header -->

        <!-- Navbar Header 最上方横向的一行（搜索等等）没啥用-->
        <nav class="navbar navbar-header navbar-expand-lg" data-background-color="dark">

            <div class="container-fluid">
                <p id = header>多类密度图的声明式渲染模型</p>
<!--                <div class="collapse" id="search-nav">-->
<!--                    <form class="navbar-left navbar-form nav-search mr-md-3">-->
<!--                        <div class="input-group">-->
<!--                            <div class="input-group-prepend">-->
<!--                                <button type="submit" class="btn btn-search pr-1">-->
<!--                                    <i class="fa fa-search search-icon"></i>-->
<!--                                </button>-->
<!--                            </div>-->
<!--                            <input type="text" placeholder="Search ..." class="form-control">-->
<!--                        </div>-->
<!--                    </form>-->
<!--                </div>-->
                <ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
                    <li class="nav-item toggle-nav-search hidden-caret">
                        <a class="nav-link" data-toggle="collapse" href="#search-nav" role="button" aria-expanded="false" aria-controls="search-nav">
                            <i class="fa fa-search"></i>
                        </a>
                    </li>
                    <li class="nav-item dropdown hidden-caret" id = 'button_upload'>
                        <input type="file" id="button_input">
                        <a class="nav-link dropdown-toggle" href="#" id="notifDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="json_upload()">
                            <i class="fa fa-upload"></i>
                            <!--                            <span class="notification">4</span>-->
                        </a>
                        <!--                        <ul class="dropdown-menu notif-box animated fadeIn" aria-labelledby="notifDropdown">-->
                        <!--                            <li>-->
                        <!--                                <div class="dropdown-title">You have 4 new notification</div>-->
                        <!--                            </li>-->
                        <!--                            <li>-->
                        <!--                                <div class="notif-scroll scrollbar-outer">-->
                        <!--                                    <div class="notif-center">-->
                        <!--                                        <a href="#">-->
                        <!--                                            <div class="notif-icon notif-primary"> <i class="fa fa-user-plus"></i> </div>-->
                        <!--                                            <div class="notif-content">-->
                        <!--													<span class="block">-->
                        <!--														New user registered-->
                        <!--													</span>-->
                        <!--                                                <span class="time">5 minutes ago</span>-->
                        <!--                                            </div>-->
                        <!--                                        </a>-->
                        <!--                                        <a href="#">-->
                        <!--                                            <div class="notif-icon notif-success"> <i class="fa fa-comment"></i> </div>-->
                        <!--                                            <div class="notif-content">-->
                        <!--													<span class="block">-->
                        <!--														Rahmad commented on Admin-->
                        <!--													</span>-->
                        <!--                                                <span class="time">12 minutes ago</span>-->
                        <!--                                            </div>-->
                        <!--                                        </a>-->
                        <!--                                        <a href="#">-->
                        <!--                                            <div class="notif-img">-->
                        <!--                                                <img src="assets/img/profile2.jpg" alt="Img Profile">-->
                        <!--                                            </div>-->
                        <!--                                            <div class="notif-content">-->
                        <!--													<span class="block">-->
                        <!--														Reza send messages to you-->
                        <!--													</span>-->
                        <!--                                                <span class="time">12 minutes ago</span>-->
                        <!--                                            </div>-->
                        <!--                                        </a>-->
                        <!--                                        <a href="#">-->
                        <!--                                            <div class="notif-icon notif-danger"> <i class="fa fa-heart"></i> </div>-->
                        <!--                                            <div class="notif-content">-->
                        <!--													<span class="block">-->
                        <!--														Farrah liked Admin-->
                        <!--													</span>-->
                        <!--                                                <span class="time">17 minutes ago</span>-->
                        <!--                                            </div>-->
                        <!--                                        </a>-->
                        <!--                                    </div>-->
                        <!--                                </div>-->
                        <!--                            </li>-->
                        <!--                            <li>-->
                        <!--                                <a class="see-all" href="javascript:void(0);">See all notifications<i class="fa fa-angle-right"></i> </a>-->
                        <!--                            </li>-->
                        <!--                        </ul>-->
                    </li>
                    <li class="nav-item dropdown hidden-caret" id = 'button_download'>
                        <a class="nav-link dropdown-toggle" href="#" id="messageDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="json_download()">
                            <i class="fa fa-download"></i>
                        </a>
<!--                        <ul class="dropdown-menu messages-notif-box animated fadeIn" aria-labelledby="messageDropdown">-->
<!--                            <li>-->
<!--                                <div class="dropdown-title d-flex justify-content-between align-items-center">-->
<!--                                    Messages-->
<!--                                    <a href="#" class="small">Mark all as read</a>-->
<!--                                </div>-->
<!--                            </li>-->
<!--                            <li>-->
<!--                                <div class="message-notif-scroll scrollbar-outer">-->
<!--                                    <div class="notif-center">-->
<!--                                        <a href="#">-->
<!--                                            <div class="notif-img">-->
<!--                                                <img src="assets/img/jm_denis.jpg" alt="Img Profile">-->
<!--                                            </div>-->
<!--                                            <div class="notif-content">-->
<!--                                                <span class="subject">Jimmy Denis</span>-->
<!--                                                <span class="block">-->
<!--														How are you ?-->
<!--													</span>-->
<!--                                                <span class="time">5 minutes ago</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a href="#">-->
<!--                                            <div class="notif-img">-->
<!--                                                <img src="assets/img/chadengle.jpg" alt="Img Profile">-->
<!--                                            </div>-->
<!--                                            <div class="notif-content">-->
<!--                                                <span class="subject">Chad</span>-->
<!--                                                <span class="block">-->
<!--														Ok, Thanks !-->
<!--													</span>-->
<!--                                                <span class="time">12 minutes ago</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a href="#">-->
<!--                                            <div class="notif-img">-->
<!--                                                <img src="assets/img/mlane.jpg" alt="Img Profile">-->
<!--                                            </div>-->
<!--                                            <div class="notif-content">-->
<!--                                                <span class="subject">Jhon Doe</span>-->
<!--                                                <span class="block">-->
<!--														Ready for the meeting today...-->
<!--													</span>-->
<!--                                                <span class="time">12 minutes ago</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a href="#">-->
<!--                                            <div class="notif-img">-->
<!--                                                <img src="assets/img/talha.jpg" alt="Img Profile">-->
<!--                                            </div>-->
<!--                                            <div class="notif-content">-->
<!--                                                <span class="subject">Talha</span>-->
<!--                                                <span class="block">-->
<!--														Hi, Apa Kabar ?-->
<!--													</span>-->
<!--                                                <span class="time">17 minutes ago</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </li>-->
<!--                            <li>-->
<!--                                <a class="see-all" href="javascript:void(0);">See all messages<i class="fa fa-angle-right"></i> </a>-->
<!--                            </li>-->
<!--                        </ul>-->
                    </li>

                    <li class="nav-item dropdown hidden-caret">
                        <a class="nav-link" data-toggle="dropdown" href="#" aria-expanded="false" onclick="json_print()">
                            <i class="fas fa-print"></i>
                        </a>
<!--                        <div class="dropdown-menu quick-actions quick-actions-info animated fadeIn">-->
<!--                            <div class="quick-actions-header">-->
<!--                                <span class="title mb-1">Quick Actions</span>-->
<!--                                <span class="subtitle op-8">Shortcuts</span>-->
<!--                            </div>-->
<!--                            <div class="quick-actions-scroll scrollbar-outer">-->
<!--                                <div class="quick-actions-items">-->
<!--                                    <div class="row m-0">-->
<!--                                        <a class="col-6 col-md-4 p-0" href="#">-->
<!--                                            <div class="quick-actions-item">-->
<!--                                                <i class="flaticon-file-1"></i>-->
<!--                                                <span class="text">Generated Report</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a class="col-6 col-md-4 p-0" href="#">-->
<!--                                            <div class="quick-actions-item">-->
<!--                                                <i class="flaticon-database"></i>-->
<!--                                                <span class="text">Create New Database</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a class="col-6 col-md-4 p-0" href="#">-->
<!--                                            <div class="quick-actions-item">-->
<!--                                                <i class="flaticon-pen"></i>-->
<!--                                                <span class="text">Create New Post</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a class="col-6 col-md-4 p-0" href="#">-->
<!--                                            <div class="quick-actions-item">-->
<!--                                                <i class="flaticon-interface-1"></i>-->
<!--                                                <span class="text">Create New Task</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a class="col-6 col-md-4 p-0" href="#">-->
<!--                                            <div class="quick-actions-item">-->
<!--                                                <i class="flaticon-list"></i>-->
<!--                                                <span class="text">Completed Tasks</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                        <a class="col-6 col-md-4 p-0" href="#">-->
<!--                                            <div class="quick-actions-item">-->
<!--                                                <i class="flaticon-file"></i>-->
<!--                                                <span class="text">Create New Invoice</span>-->
<!--                                            </div>-->
<!--                                        </a>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
                    </li>
                    <li class="nav-item dropdown hidden-caret">
                        <a class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#" aria-expanded="false">
                            <div class="avatar-sm">
                                <img src="assets/img/profile.jpg" alt="..." class="avatar-img rounded-circle">
                            </div>
                        </a>
                        <ul class="dropdown-menu dropdown-user animated fadeIn">
                            <div class="dropdown-user-scroll scrollbar-outer">
                                <li>
                                    <div class="user-box">
                                        <div class="avatar-lg"><img src="assets/img/profile.jpg" alt="image profile" class="avatar-img rounded"></div>
                                        <div class="u-text">
                                            <h4>Elroy Tian(田方正)</h4>
                                            <p class="text-muted">elroy-t.github.io</p><a href="profile.html" class="btn btn-xs btn-secondary btn-sm">View my github</a>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="#">QQ:   1014773942</a>
                                    <a class="dropdown-item" href="#">Mail: 1014773842@qq.com</a>
<!--                                    <a class="dropdown-item" href="#">Inbox</a>-->
<!--                                    <div class="dropdown-divider"></div>-->
<!--                                    <a class="dropdown-item" href="#">Account Setting</a>-->
<!--                                    <div class="dropdown-divider"></div>-->
<!--                                    <a class="dropdown-item" href="#">Logout</a>-->
                                </li>
                            </div>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- End Navbar -->

    </div>

    <!-- -------Sidebar 左侧导航栏----- -->
    <div class="sidebar sidebar-style-2" data-background-color="dark2">
        <div class="sidebar-wrapper scrollbar scrollbar-inner">
            <div class="sidebar-content">
                <div class="user">
                    <div class="avatar-sm float-left mr-2">
                        <img src="assets/img/profile.jpg" alt="..." class="avatar-img rounded-circle">
                    </div>
                    <div class="info">
                        <a data-toggle="collapse" href="#collapseExample" aria-expanded="true">
								<span>
									田方正
									<span class="user-level">201600130081</span>
									<span class="caret"></span>
								</span>
                        </a>
                        <div class="clearfix"></div>

                        <div class="collapse in" id="collapseExample">
                            <ul class="nav">
                                <li>
                                    <a href="#profile">
                                        <span class="link-collapse">山东大学</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#edit">
                                        <span class="link-collapse">计算机科学与技术学院</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#settings">
                                        <span class="link-collapse">计算机科学与技术专业</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#settings">
                                        <span class="link-collapse">2016级二班（本科生）</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <ul class="nav nav-primary">
                    <li class="nav-item active">
                        <a data-toggle="collapse" href="#dataset" class="collapsed" aria-expanded="false">
                            <i class="fas fa-database"></i>
                            <p>选择数据源</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse" id="dataset">
                            <ul class="nav nav-collapse">
                                <li>
                                    <a data-toggle="collapse" href="#dataset" onclick="dataset_source = 0;console.log('dataset_source='+dataset_source)">
                                        <span class="sub-item">数据源 1</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle="collapse" href="#dataset" onclick="dataset_source = 1;console.log('dataset_source='+dataset_source)">
                                        <span class="sub-item">数据源 2</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle="collapse" href="#dataset" onclick="dataset_source = 2;console.log('dataset_source='+dataset_source)">
                                        <span class="sub-item">数据源 3</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-section">
							<span class="sidebar-mini-icon">
								<i class="fa fa-ellipsis-h"></i>
							</span>
                        <h4 class="text-section">设 置</h4>
                    </li>

                    <li class="nav-item">
                        <a data-toggle="collapse" href="#rebin">
                            <i class="fas fa-square"></i>
                            <p>平铺方式</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse" id="rebin">
                            <ul class="nav nav-collapse">
                                <li>
                                    <a data-toggle ="collapse" href="#rebin" onclick="rebin_type = 0;console.log('rebin_type='+rebin_type+'(点)')">
                                        <span class="sub-item">像素平铺</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#rebin" onclick="rebin_type = 1;console.log('rebin_type='+rebin_type+'(正方形)')">
                                        <span class="sub-item">正方形平铺</span>
                                    </a>
<!--                                    <div class="collapse" id="subrebin">-->
<!--                                        <ul class="nav nav-collapse subnav">-->
<!--                                            <li>-->
<!--                                                <a data-toggle ="collapse" href="#subrebin" href="#rebin" onclick="rebin_type = 1;rebin_square_size_type = 0;console.log('rebin_type='+rebin_type+'(正方形)')">-->
<!--                                                    <span class="sub-item">Level 2</span>-->
<!--                                                </a>-->
<!--                                            </li>-->
<!--                                            <li>-->
<!--                                                <a data-toggle ="collapse" href="#rebin" onclick="rebin_type = 1;rebin_square_size_type = 1;console.log('rebin_type='+rebin_type+'(正方形)')" >-->
<!--                                                    <span class="sub-item">Level 2</span>-->
<!--                                                </a>-->
<!--                                            </li>-->
<!--                                        </ul>-->
<!--                                    </div>-->
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-item">
                        <a data-toggle="collapse" href="#squaresize">
                            <i class="fas fa-expand-arrows-alt"></i>
                            <p>数据砖大小</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse" id="squaresize">
                            <ul class="nav nav-collapse">
                                <li>
                                    <a data-toggle ="collapse" href="#squaresize" onclick="rebin_square_size_type = 0;console.log('rebin_square_size_type='+rebin_square_size_type)">
                                        <span class="sub-item">Small</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#squaresize" onclick="rebin_square_size_type = 1;console.log('rebin_square_size_type='+rebin_square_size_type)">
                                        <span class="sub-item">Default</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#squaresize" onclick="rebin_square_size_type = 2;console.log('rebin_square_size_type='+rebin_square_size_type)">
                                        <span class="sub-item">Large</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#squaresize" onclick="rebin_square_size_type = 3;console.log('rebin_square_size_type='+rebin_square_size_type)">
                                        <span class="sub-item">Auto</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-item">
                        <a data-toggle="collapse" href="#scale">
                            <i class="fas fa-signal"></i>
                            <p>比例尺</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse" id="scale">
                            <ul class="nav nav-collapse">
                                <li>
                                    <a data-toggle ="collapse" href="#scale" onclick="scale_type = 0;console.log('scale_type='+scale_type)">
                                        <span class="sub-item">线性比例尺</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#scale" onclick="scale_type = 1;console.log('scale_type='+scale_type)">
                                        <span class="sub-item">对数比例尺</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#scale" onclick="scale_type = 2;console.log('scale_type='+scale_type)">
                                        <span class="sub-item">平方根比例尺</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#scale" onclick="scale_type = 3;console.log('scale_type='+scale_type)">
                                        <span class="sub-item">立方根比例尺</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#scale" onclick="scale_type = 4;console.log('scale_type='+scale_type)">
                                        <span class="sub-item">等深线比例尺</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a data-toggle="collapse" href="#compose">
                            <i class="fas fa-sliders-h"></i>
                            <p>可视化模式</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse" id="compose">
                            <ul class="nav nav-collapse">
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 0;console.log('mood='+mood)">
                                        <span class="sub-item">None</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 1;console.log('mood='+mood)">
                                        <span class="sub-item">Max</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 2;console.log('mood='+mood)">
                                        <span class="sub-item">Mean</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 3;console.log('mood='+mood)">
                                        <span class="sub-item">Blend</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 4;console.log('mood='+mood)">
                                        <span class="sub-item">Invmin</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 5;console.log('mood='+mood)">
                                        <span class="sub-item">Weaving</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 6;console.log('mood='+mood)">
                                        <span class="sub-item">Propline</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 7;console.log('mood='+mood)">
                                        <span class="sub-item">Division</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 8;console.log('mood='+mood)">
                                        <span class="sub-item">Separate</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 9;console.log('mood='+mood)">
                                        <span class="sub-item">Time</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 10;console.log('mood='+mood)">
                                        <span class="sub-item">Hatching</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#compose" onclick="mood = 11;console.log('mood='+mood)">
                                        <span class="sub-item">Glyph</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a data-toggle="collapse" href="#legend">
                            <i class="fas fa-table"></i>
                            <p>显示图例</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse" id="legend">
                            <ul class="nav nav-collapse">
                                <li>
                                    <a data-toggle ="collapse" href="#legend" onclick="legend_if = 0;console.log('legend_if='+legend_if)">
                                        <span class="sub-item">是</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#legend" onclick="legend_if = 1;console.log('legend_if='+legend_if)">
                                        <span class="sub-item">否</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a data-toggle="collapse" href="#axis">
                            <i class="fas fa-chart-area"></i>
                            <p>显示坐标轴</p>
                            <span class="caret"></span>
                        </a>
                        <div class="collapse" id="axis">
                            <ul class="nav nav-collapse">
                                <li>
                                    <a data-toggle ="collapse" href="#axis" onclick="axis_if = 0;console.log('axis_if='+axis_if)">
                                        <span class="sub-item">是</span>
                                    </a>
                                </li>
                                <li>
                                    <a data-toggle ="collapse" href="#axis" onclick="axis_if = 1;console.log('axis_if='+axis_if)">
                                        <span class="sub-item">否</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>



<!--                    <li class="nav-item">-->
<!--                        <a href="widgets.html">-->
<!--                            <i class="fas fa-desktop"></i>-->
<!--                            <p>Widgets</p>-->
<!--                            <span class="badge badge-success">4</span>-->
<!--                        </a>-->
<!--                    </li>-->
<!--                    <li class="nav-item">-->
<!--                        <a data-toggle="collapse" href="#submenu">-->
<!--                            <i class="fas fa-bars"></i>-->
<!--                            <p>Menu Levels</p>-->
<!--                            <span class="caret"></span>-->
<!--                        </a>-->
<!--                        <div class="collapse" id="submenu">-->
<!--                            <ul class="nav nav-collapse">-->
<!--                                <li>-->
<!--                                    <a data-toggle="collapse" href="#subnav1">-->
<!--                                        <span class="sub-item">Level 1</span>-->
<!--                                        <span class="caret"></span>-->
<!--                                    </a>-->
<!--                                    <div class="collapse" id="subnav1">-->
<!--                                        <ul class="nav nav-collapse subnav">-->
<!--                                            <li>-->
<!--                                                <a href="#">-->
<!--                                                    <span class="sub-item">Level 2</span>-->
<!--                                                </a>-->
<!--                                            </li>-->
<!--                                            <li>-->
<!--                                                <a href="#">-->
<!--                                                    <span class="sub-item">Level 2</span>-->
<!--                                                </a>-->
<!--                                            </li>-->
<!--                                        </ul>-->
<!--                                    </div>-->
<!--                                </li>-->
<!--                                <li>-->
<!--                                    <a data-toggle="collapse" href="#subnav2">-->
<!--                                        <span class="sub-item">Level 1</span>-->
<!--                                        <span class="caret"></span>-->
<!--                                    </a>-->
<!--                                    <div class="collapse" id="subnav2">-->
<!--                                        <ul class="nav nav-collapse subnav">-->
<!--                                            <li>-->
<!--                                                <a href="#">-->
<!--                                                    <span class="sub-item">Level 2</span>-->
<!--                                                </a>-->
<!--                                            </li>-->
<!--                                        </ul>-->
<!--                                    </div>-->
<!--                                </li>-->
<!--                                <li>-->
<!--                                    <a href="#">-->
<!--                                        <span class="sub-item">Level 1</span>-->
<!--                                    </a>-->
<!--                                </li>-->
<!--                            </ul>-->
<!--                        </div>-->
<!--                    </li>-->
                    <li class="mx-4 mt-2">
                        <a href="#" class="btn btn-primary btn-block"
                           onclick="console.log('dataset: '+dataset_source+' rebin: '+ rebin_type+' scale: '+scale_type+' mood: '+mood+' legend: '+legend_if+' axis: '+axis_if); generate_pre(); {

                           }">
                            <span class="btn-label mr-2"></span><i class="fas fa-edit"></i> 生 成</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
    <!-- End Sidebar -->

    <!--   Core JS Files   -->
    <script src="assets/js/core/jquery.3.2.1.min.js"></script>
    <script src="assets/js/core/popper.min.js"></script>
    <script src="assets/js/core/bootstrap.min.js"></script>

    <!-- jQuery UI -->
    <script src="assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>

    <!-- jQuery Scrollbar -->
    <script src="assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>


    <!-- Chart JS -->
    <script src="assets/js/plugin/chart.js/chart.min.js"></script>

    <!-- jQuery Sparkline -->
    <script src="assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js"></script>

    <!-- Chart Circle -->
    <script src="assets/js/plugin/chart-circle/circles.min.js"></script>

    <!-- Datatables -->
    <script src="assets/js/plugin/datatables/datatables.min.js"></script>

    <!-- Bootstrap Notify -->
    <script src="assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>

    <!-- jQuery Vector Maps -->
    <script src="assets/js/plugin/jqvmap/jquery.vmap.min.js"></script>
    <script src="assets/js/plugin/jqvmap/maps/jquery.vmap.world.js"></script>

    <!-- Sweet Alert -->
    <script src="assets/js/plugin/sweetalert/sweetalert.min.js"></script>

    <!-- Atlantis JS -->
    <script src="assets/js/atlantis.min.js"></script>

    <!-- Atlantis DEMO methods, don't include it in your project!
    <script src="assets/js/setting-demo.js"></script>
    <script src="assets/js/demo.js"></script>-->




    <!-- ---------以上为网页设计------- -->

<div id="canvas-frame"></div>
<div id = "legend-zone">
    <div class="card-body">
        <h4 class="mb-1 fw-bold">图例：</h4>

<!--        <p>-->
<!--            legend-->
<!--        </p>-->
        <div id = 'canvas-legend'>

        </div>
    </div>
</div>
<!--<div id = "json-zone">-->
<!--    <p>-->
<!--        json-->
<!--    </p>-->
<!--</div>-->
    <div class="card card-primary bg-primary-gradient" id = "json-zone">
        <div class="card-body" >
            <h4 class="mb-1 fw-bold">JSON 语句</h4>
            <pre class="pre-scrollable" >
                <code  id = "json-code">
{
"data": {
"url1": "<code id = js-url1></code>",
"color1": "<code id = js-color1></code>",
"url2": "<code id = js-url2></code>",
"color2": "<code id = js-color2></code>",
"url3": "<code id = js-url3></code>",
"color3": "<code id = js-color3></code>",
"url4": "<code id = js-url4></code>",
"color4": "<code id = js-color4></code>"
},
"rebin": {
"type": "<code id = js-rebin></code>",
"size": "<code id = js-rebin_size></code>"
},
"compose": {
"mix": "<code id = js-compose></code>"
},
"smooth": {
"type": "<code id = js-smooth></code>",
"radius": "<code id = js-smooth_radius></code>"
},
"rescale": {
"type": "<code id = js-scale></code>"
},
"legend": <code id = js-legend></code>,
"axis": <code id = js-axis></code>
}
            </code>
            </pre>

        </div>
    </div>
    <canvas id="canvas" style="display: none;">你的浏览器不支持canvas</canvas>
</body>
</html>